#!/usr/bin/env bun
// @bun
var DJ=Object.defineProperty;var t=(J,X)=>{for(var Q in X)DJ(J,Q,{get:X[Q],enumerable:!0,configurable:!0,set:($)=>X[Q]=()=>$})};var S=(J,X)=>()=>(J&&(X=J(J=0)),X);class f{minLevel;colors;showTimestamp;name;constructor(J){let{level:X="INFO",colors:Q=!0,timestamp:$=!0,name:K}=J??{};this.minLevel=X,this.showTimestamp=$,this.name=K;let H=typeof process!=="undefined"&&!!process.env.NO_COLOR,z=typeof process!=="undefined"&&!!process.stdout&&!!process.stdout.isTTY;this.colors=Q&&!H&&z}shouldLog(J){return T[J]>=0&&T[J]>=T[this.minLevel]&&T[this.minLevel]<T.NONE}levelMeta(J){switch(J){case"DEBUG":return{tag:"DEBUG",color:E.debug,emoji:"\uD83D\uDC1B"};case"INFO":return{tag:"INFO",color:E.info,emoji:"ℹ️"};case"WARN":return{tag:"WARN",color:E.warn,emoji:"⚠️"};case"ERROR":return{tag:"ERROR",color:E.error,emoji:"❌"}}}timestamp(){if(!this.showTimestamp)return"";return new Date().toISOString()}padLevelTag(J){return J.padEnd(5," ")}colorize(J,X){if(!this.colors||!X)return J;return`${X}${J}${E.reset}`}format(J,X){let Q=this.levelMeta(J),$=this.timestamp(),K=this.name?`[${this.name}] `:"",H=`[ ${this.padLevelTag(Q.tag)} ]`,z=Q.emoji;if(this.colors){let W=this.colorize(H,Q.color),j=this.colorize($?`${$} `:"",E.gray),q=this.colorize(K,E.dim);return`${j}${q}${W} ${z} ${X}`}return`${$?`${$} `:""}${K}${H} ${z} ${X}`}write(J,X){if(!this.shouldLog(J))return;let Q=this.format(J,X);switch(J){case"DEBUG":return console.debug?console.debug(Q):console.log(Q);case"INFO":return console.info?console.info(Q):console.log(Q);case"WARN":return console.warn?console.warn(Q):console.log(Q);case"ERROR":return console.error?console.error(Q):console.log(Q)}}debug(J){this.write("DEBUG",J)}info(J){this.write("INFO",J)}warn(J){this.write("WARN",J)}error(J){this.write("ERROR",J)}child(J){return new f({level:this.minLevel,colors:this.colors,timestamp:this.showTimestamp,name:J})}setLevel(J){this.minLevel=J}}var T,E;var VJ=S(()=>{T={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4},E={reset:"\x1B[0m",bold:"\x1B[1m",dim:"\x1B[2m",debug:"\x1B[36m",info:"\x1B[32m",warn:"\x1B[33m",error:"\x1B[31m",gray:"\x1B[90m"}});var BJ={};t(BJ,{sleep:()=>uJ,saveTopConfig:()=>CJ,saveCollectionConfig:()=>IJ,loadTopConfig:()=>l,loadCollectionConfig:()=>hJ,getCollectionTopConfig:()=>mJ,getCollectionFilesBase:()=>o,ensureConfigDirs:()=>qJ,ensureConfigDir:()=>YJ,TOP_CONFIG_FILE:()=>R});import _ from"node:fs/promises";import{existsSync as p}from"node:fs";import O from"node:path";async function YJ(J){if(Z.debug(`Ensuring config dir: ${J}`),!p(J))Z.warn(`Dir (${J}) does not exist, creating...`),await _.mkdir(J,{recursive:!0})}async function qJ(J){let X=J.collections;console.debug(`Ensuring config dir for ${X.length} collection(s)`);for(let Q of X){let $=Q.configDir;if(Z.debug(`Ensuring config dir: ${$}`),!p($))Z.warn(`Dir (${$}) does not exist, creating...`),await _.mkdir($,{recursive:!0})}}async function l(){if(Z.debug(`Loading top config from: ${R}`),!p(R))return Z.warn("Top config file not found"),null;let J=await _.readFile(R,"utf8");return JSON.parse(J)}async function CJ(J){Z.debug("Saving top config"),await qJ(J),await _.writeFile(R,`${JSON.stringify(J,null,2)}
`,"utf8")}async function o(J){Z.debug("Getting Collection file base");let X=await l(),Q=X.collections.find((K)=>K.id===J).configDir;if(!X||!X.collections)return Z.warn(`No Top config found for ${J}, returning default`),{pagesFile:O.join(Q,`${J}.pages.json`),configFile:O.join(Q,`${J}.config.json`),saveDir:"docs",configDir:Q};let $=X.collections.find((K)=>K.id===J);if(!$)return Z.warn(`Collection config for ${J} not found, returning default paths`),{pagesFile:O.join(Q,`${J}.pages.json`),configFile:O.join(Q,`${J}.config.json`),saveDir:"docs",configDir:".config"};return{pagesFile:$.pagesFile||O.join(Q,`${J}.pages.json`),configFile:$.configFile||O.join(Q,`${J}.config.json`),saveDir:$.saveDir||"docs",configDir:$.configDir||".config"}}async function hJ(J){Z.debug(`Loading collection config for ${J}`);let{configFile:X}=await o(J);if(!p(X))return Z.warn(`Collection config file for ${J} not found`),null;let Q=await _.readFile(X,"utf8");return JSON.parse(Q)}async function mJ(J){Z.debug(`Getting Top Collection Config for ${J}`);let X=await l();if(!X||!X.collections)return Z.debug(`No Top Config found for ${J}`),null;return X.collections.find((Q)=>Q.id===J)||null}async function IJ(J){Z.debug(`Saving Collection config for ${J.collectionId}`);let{configFile:X,configDir:Q}=await o(J.collectionId);await YJ(Q),await _.writeFile(X,`${JSON.stringify(J,null,2)}
`,"utf8")}var R,uJ=(J)=>new Promise((X)=>setTimeout(X,J));var MJ=S(async()=>{await N();R=O.join("outline-sync.json")});import F from"node:fs/promises";import{existsSync as s}from"node:fs";import y from"node:path";async function jJ(J){if(Z.debug(`Ensuring config dir: ${J}`),!s(J))Z.warn(`Dir (${J}) does not exist, creating...`),await F.mkdir(J,{recursive:!0})}async function JJ(J){let X=J.collections;console.debug(`Ensuring config dir for ${X.length} collection(s)`);for(let Q of X){let $=Q.configDir;if(Z.debug(`Ensuring config dir: ${$}`),!s($))Z.warn(`Dir (${$}) does not exist, creating...`),await F.mkdir($,{recursive:!0})}}async function P(){if(Z.debug(`Loading top config from: ${d}`),!s(d))return Z.warn("Top config file not found"),null;let J=await F.readFile(d,"utf8");return JSON.parse(J)}async function QJ(J){Z.debug("Saving top config"),await JJ(J),await F.writeFile(d,`${JSON.stringify(J,null,2)}
`,"utf8")}async function x(J){Z.debug("Getting Collection file base");let X=await P(),Q=X.collections.find((K)=>K.id===J).configDir;if(!X||!X.collections)return Z.warn(`No Top config found for ${J}, returning default`),{pagesFile:y.join(Q,`${J}.pages.json`),configFile:y.join(Q,`${J}.config.json`),saveDir:"docs",configDir:Q};let $=X.collections.find((K)=>K.id===J);if(!$)return Z.warn(`Collection config for ${J} not found, returning default paths`),{pagesFile:y.join(Q,`${J}.pages.json`),configFile:y.join(Q,`${J}.config.json`),saveDir:"docs",configDir:".config"};return{pagesFile:$.pagesFile||y.join(Q,`${J}.pages.json`),configFile:$.configFile||y.join(Q,`${J}.config.json`),saveDir:$.saveDir||"docs",configDir:$.configDir||".config"}}async function UJ(J){Z.debug(`Loading collection config for ${J}`);let{configFile:X}=await x(J);if(!s(X))return Z.warn(`Collection config file for ${J} not found`),null;let Q=await F.readFile(X,"utf8");return JSON.parse(Q)}var d,e=(J)=>new Promise((X)=>setTimeout(X,J));var r=S(async()=>{await N();d=y.join("outline-sync.json")});async function D(J,X,Q=3){let $=`${AJ}/api/${J}`;for(let K=0;K<Q;K++)try{Z.debug(`Outline request: POST ${$} (attempt ${K+1})`),Z.debug(`Payload (trimmed): ${JSON.stringify(X,null,2)}`);let H=await fetch($,{method:"POST",headers:pJ,body:JSON.stringify(X)});if(H.status===429){let W=1000*(K+1);Z.warn(`Rate limited by Outline API. Backing off ${W}ms (attempt ${K+1}).`),await e(W);continue}let z;try{z=await H.json()}catch(W){throw Z.error(`Failed to parse JSON response from ${J}: ${W}`),W}if(!H.ok)throw Z.error(`[Outline@${AJ}/api/${J}] HTTP ${H.status} - payload=${JSON.stringify(X)} response=${JSON.stringify(z)}`),new Error(`Outline API error ${H.status}: ${JSON.stringify(z)}`);return Z.debug(`Outline response for ${J} (attempt ${K+1}): ${JSON.stringify(z).slice(0,200)}${JSON.stringify(z).length>200?"...":""}`),z}catch(H){if(K===Q-1)throw Z.error(`Request to Outline failed after ${Q} attempts: ${H?.message??H}`),H;let z=500*(K+1);Z.warn(`Request failed (attempt ${K+1}): ${H?.message??H}. Retrying after ${z}ms...`),await e(z)}throw new Error("outlineRequest: unreachable")}async function kJ(){let J=[],X=0,Q=100;while(!0){let K=(await D("collections.list",{offset:X,limit:Q})).data||[];for(let H of K)J.push({id:H.id,name:H.name});if(K.length<Q)break;X+=K.length}return Z.debug(`listCollectionsPaged: returned ${J.length} collections`),J}async function wJ(J){let X=[],Q=0,$=100;while(!0){let H=(await D("documents.list",{collectionId:J,offset:Q,limit:$})).data||[];for(let z of H)X.push(z);if(H.length<$)break;Q+=H.length}return Z.debug(`listDocumentsInCollection(${J}): returned ${X.length} documents`),X}async function GJ(J){let X=await D("documents.info",{id:J});return Z.debug(`fetchDocumentInfo(${J}) -> ${X?"ok":"null"}`),X.data??null}async function LJ(J,X,Q,$){let H=await D("documents.create",{title:J,text:X,collectionId:Q,parentDocumentId:$||null,publish:!0});return Z.info(`Created document "${J}" in collection ${Q} (id=${H?.id??"unknown"})`),H.data}async function XJ(J,X,Q){let $={id:J,text:Q,publish:!0};if(X)$.title=X;let K=await D("documents.update",$);return Z.info(`Updated document id=${J}${X?` title="${X}"`:""}`),K.data}var AJ,fJ,pJ;var ZJ=S(async()=>{await r();await N();AJ=process.env.OUTLINE_BASE_URL||"https://app.getoutline.com",fJ=process.env.OUTLINE_API_KEY||"",pJ={Authorization:`Bearer ${fJ}`,"Content-Type":"application/json"}});import a from"node:fs/promises";import{existsSync as dJ}from"node:fs";import u from"node:path";import{spawnSync as sJ}from"node:child_process";function $J(J){return J.replace(/\s+/g,"")}function C(J){return J.toString().normalize("NFKD").replace(/\p{M}/gu,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").slice(0,120)}function rJ(J){try{let X=u.resolve(J),Q=sJ("git",["log","-1","--format=%ct","--",X],{cwd:process.cwd(),encoding:"utf8"});if(Q.status!==0)return Z.debug(`git log returned non-zero status for ${X}: ${Q.status}`),null;let $=(Q.stdout||"").trim();if(!$)return Z.debug(`git log returned no output for ${X}`),null;let K=Number($);if(Number.isNaN(K))return Z.debug(`git log output not a number for ${X}: "${$}"`),null;return K*1000}catch(X){return Z.debug(`getGitTimestampMs error for ${J}: ${X}`),null}}async function SJ(J){let X=rJ(J);if(X)return Z.debug(`Using git timestamp for ${J}: ${X}`),X;let Q=await a.stat(J);return Z.debug(`Using FS mtime for ${J}: ${Q.mtimeMs}`),Q.mtimeMs}async function g(J,X,Q=!1){if(dJ(J)){let $=`${J}.outline-sync.bak.${Date.now()}`;if(!Q)try{await a.copyFile(J,$),Z.info(`Backed up existing file to ${$}`)}catch(K){Z.warn(`Failed to back up ${J} to ${$}: ${K}`)}else Z.debug(`[dry-run] would backup existing file ${J} -> ${$}`)}else if(!Q)try{await a.mkdir(u.dirname(J),{recursive:!0}),Z.debug(`Ensured directory ${u.dirname(J)}`)}catch($){Z.warn(`Failed to create directory ${u.dirname(J)}: ${$}`)}else Z.debug(`[dry-run] would ensure directory ${u.dirname(J)}`);if(!Q)try{await a.writeFile(J,X,"utf8"),Z.info(`Wrote file ${J} (${X.length} bytes)`)}catch($){throw Z.error(`Failed to write file ${J}: ${$}`),$}else Z.debug(`[dry-run] would write file ${J} (${X.length} bytes)`)}var HJ=S(async()=>{await N()});var EJ={};t(EJ,{question:()=>n,listCollectionsPrompt:()=>gJ,bootstrapCollection:()=>cJ});import c from"node:fs/promises";import{existsSync as aJ}from"node:fs";import b from"node:path";async function gJ(J){let X=await kJ();if(!X.length){Z.warn("No collections found for this API key.");return}if(console.info("Collections:"),X.forEach((q,V)=>console.info(`${V+1}) ${q.id}	${q.name}`)),J.nonInteractive)return;let Q=await n("Select a collection by number (or press Enter to cancel): "),$=Number(Q.trim());if(!$||$<1||$>X.length){Z.warn("Cancelled collection selection.");return}let K=X[$-1];Z.info(`You chose: ${K.name} (${K.id})`),await JJ(await P()||{collections:[]});let H=await P()||{collections:[]},z=H.collections.find((q)=>q.id===K.id),W=(await n("Enter a base folder path for the collections config files (or press enter for default `.config`): ")).replaceAll(`
`,"");if(W.trim().length<=1)W=".config",Z.debug("Using default configDir `.config`");let j=(await n("Enter a base folder path for the collections markdown files (or press enter for default `docs`): ")).replaceAll(`
`,"");if(j.trim().length<=1)j="docs",Z.debug("Using default saveDir `docs`");if(!z)H.collections.unshift({id:K.id,name:K.name,configDir:W,saveDir:j,pagesFile:b.join(W,`${K.id}.pages.json`),configFile:b.join(W,`${K.id}.config.json`)}),await QJ(H),Z.info(`Added collection to ${b.join("configs","outline-sync.json")}`);else Z.warn("Collection already configured.")}function n(J){return new Promise((X)=>{process.stdout.write(J),process.stdin.resume(),process.stdin.setEncoding("utf8"),process.stdin.once("data",(Q)=>{process.stdin.pause(),X(Q.toString())})})}async function cJ(J){let{collectionId:X,dryRun:Q=!1}=J;Z.info(`Bootstrapping collection ${X} (dryRun=${Q})...`);let $=await wJ(X);Z.info(`Fetched ${$.length} documents from Outline.`),Z.debug(`First 3 documents: ${JSON.stringify($.slice(0,3),null,2)}`);let K=new Map;for(let Y of $)K.set(Y.id,{title:Y.title,file:"",id:Y.id,children:[],raw:Y});let H=[];for(let Y of K.values()){let w=Y.raw||{},G=w.parentDocumentId??w.parentId??null;if(G&&K.has(G))K.get(G).children.push(Y);else H.push(Y)}Z.debug(`Built document tree with ${H.length} root(s)`);let{saveDir:z}=await x(X);function W(Y,w){let G=C(Y.title||"untitled"),zJ=b.join(w,G),FJ=b.join(zJ,"README.md");if(Y.file=FJ,Y.children?.length)for(let PJ of Y.children)W(PJ,zJ)}for(let Y of H)W(Y,z);for(let Y of K.values()){let w=Y.file,G=Y.raw?.text??`# ${Y.title}

`;if(!Q)await c.mkdir(b.dirname(w),{recursive:!0}),await c.writeFile(w,G,"utf8"),Z.debug(`Wrote file: ${w}`);else Z.debug(`[dry-run] would write ${w} (${G.length} bytes)`)}function j(Y){return{title:Y.title,file:Y.file,id:Y.id,children:(Y.children||[]).map(j)}}let q={collectionId:X,pages:H.map(j)},{pagesFile:V,configFile:B,saveDir:L,configDir:U}=await x(X);if(Z.debug(`Collection (${X}) files: pagesFile=${V}, configFile=${B}, saveDir=${L}, configDir=${U}`),await jJ(U),!Q){if(await c.writeFile(V,`${JSON.stringify(q,null,2)}
`,"utf8"),Z.info(`Saved manifest: ${V}`),!aJ(B))await c.writeFile(B,`${JSON.stringify({collectionId:X,saveDir:L,mappings:[]},null,2)}
`,"utf8"),Z.info(`Created new config: ${B}`);Z.info(`Saved config: ${B}`);let Y=await P()||{collections:[]};if(!Y.collections.find((G)=>G.id===X))Y.collections.unshift({id:X,saveDir:L,pagesFile:V,configFile:B}),await QJ(Y),Z.debug(`Updated top config with collection ${X}`)}else Z.debug(`[dry-run] would save pages to ${V} and config to ${B}`);Z.info("Bootstrap complete")}var OJ=S(async()=>{await ZJ();await r();await HJ();await N()});var bJ={};t(bJ,{syncPage:()=>KJ,runSync:()=>nJ,persistPagesManifest:()=>xJ,loadPagesManifest:()=>yJ,contentsEqualIgnoringWhitespace:()=>h,applyMappingsToManifest:()=>_J});import m from"node:fs/promises";import{existsSync as NJ}from"node:fs";import M from"node:path";async function yJ(J){let{pagesFile:X}=await x(J);if(!NJ(X))throw Z.error(`${X} not found. Run init/setup to create it`),new Error(`${X} not found. Run init/setup to create it`);let Q=await m.readFile(X,"utf8");return Z.debug(`Loaded pages manifest from ${X} (${Q.length} bytes)`),JSON.parse(Q)}async function xJ(J,X,Q=!1){let{pagesFile:$}=await x(J);if(Q){Z.debug(`[dry-run] would persist manifest to ${$}`);return}await m.writeFile($,`${JSON.stringify(X,null,2)}
`,"utf8"),Z.info(`Persisted manifest to ${$}`)}function _J(J,X){let Q=X?.mappings||[];function $(H){if(!H)return!1;if(H.endsWith("/")||H.endsWith(M.sep))return!0;return M.extname(H).toLowerCase()!==".md"}function K(H,z){let W=!1;for(let q of Q)if(q.match?.id&&H.id===q.match.id){let V=q.path;if($(V)){let B=V.endsWith("/")?V:V;H.file=M.join(B,"README.md")}else H.file=V;W=!0,Z.debug(`Mapping applied by id for "${H.title}" -> ${H.file}`);break}if(!W){for(let q of Q)if(q.match?.title&&H.title===q.match.title){let V=q.path;if($(V)){let B=V.endsWith("/")?V:V;H.file=M.join(B,"README.md")}else H.file=V;W=!0,Z.debug(`Mapping applied by title for "${H.title}" -> ${H.file}`);break}}if(!H.file){let q=C(H.title||"untitled"),V=z?M.join(z,q):M.join(X?.saveDir||"docs",q);H.file=M.join(V,"README.md"),Z.debug(`Inherited path for "${H.title}" -> ${H.file}`)}else if(!(M.dirname(H.file)&&M.dirname(H.file)!==".")){let V=z||X?.saveDir||"docs";H.file=M.join(V,H.file),Z.debug(`Normalized bare filename for "${H.title}" -> ${H.file}`)}else Z.debug(`Using mapped path for "${H.title}" -> ${H.file}`);let j=M.dirname(H.file);if(H.children?.length)for(let q of H.children)K(q,j)}for(let H of J.pages)K(H,null);return Z.debug(`Applied mappings to manifest (rules=${Q.length})`),J}function h(J,X){return $J(J)===$J(X)}async function KJ(J,X,Q,$,K){let H=Q.file,z=M.resolve(H),W=NJ(z),j=0;if(W)try{j=await SJ(z)}catch(U){Z.warn(`Failed to get local timestamp for ${z}: ${U}`),j=0}let q=null;if(Q.id)try{q=await GJ(Q.id)}catch(U){Z.warn(`Failed to fetch remote info for ${Q.title} (${Q.id}): ${U}`),q=null}let V=q?.text??null,B=q?.updatedAt?new Date(q.updatedAt).getTime():0;if(Z.debug(`syncPage("${Q.title}") localExists=${W} localTs=${j} remoteExists=${!!q} remoteUpdatedAt=${B}`),!W){if(K.mode==="pull"||K.mode==="sync"||K.mode==="push"){let U=V!=null?V:`# ${Q.title}

`;await g(z,U,K.dryRun||!1),Z.info(`[INIT] Ensured local file for "${Q.title}" -> ${z}`)}}if(!Q.id){let U=await m.readFile(z,"utf8");if(K.dryRun)Z.info(`[dry-run][CREATE] Would create remote doc for "${Q.title}" in collection ${J}`);else try{let Y=await LJ(Q.title,U,J,$);Q.id=Y?.id??Q.id,Z.info(`[CREATE] Created remote "${Q.title}" id=${Q.id}`)}catch(Y){Z.error(`[CREATE] Failed to create remote for ${Q.title}: ${Y}`)}}else{let U=await m.readFile(z,"utf8");if(K.mode==="pull")if(V!=null&&!h(U,V))Z.info(`[PULL] Remote applied to local for "${Q.title}"`),await g(z,V??"",K.dryRun||!1);else Z.debug(`[SKIP] No change (pull) for "${Q.title}"`);else if(K.mode==="push")if(V==null||!h(U,V))if(K.dryRun)Z.info(`[dry-run][PUSH] Would update remote "${Q.title}" id=${Q.id}`);else try{await XJ(Q.id,Q.title,U),Z.info(`[PUSH] Updated remote "${Q.title}" id=${Q.id}`)}catch(Y){Z.error(`[PUSH] Failed to update remote for ${Q.title}: ${Y}`)}else Z.debug(`[SKIP] No change (push) for "${Q.title}"`);else if(B>j+500)if(!h(U,V??""))Z.info(`[PULL] Remote newer -> overwrite local for "${Q.title}"`),await g(z,V??"",K.dryRun||!1);else Z.debug(`[SKIP] equal after normalizing (remote newer timestamp but content same) "${Q.title}"`);else if(j>B+500)if(!h(U,V??""))if(Z.info(`[PUSH] Local newer -> update remote for "${Q.title}"`),K.dryRun)Z.info(`[dry-run] would update remote ${Q.title}`);else try{await XJ(Q.id,Q.title,U),Z.info(`[PUSH] Updated remote "${Q.title}" id=${Q.id}`)}catch(Y){Z.error(`[PUSH] Failed to update remote for ${Q.title}: ${Y}`)}else Z.debug(`[SKIP] equal after normalizing (local newer timestamp but content same) "${Q.title}"`);else Z.debug(`[SKIP] No changes for "${Q.title}"`)}let L=Q.id||$;if(Q.children?.length)for(let U of Q.children)await KJ(J,X,U,L,K)}async function nJ(J){let{collectionId:X,mode:Q,dryRun:$=!1}=J;Z.info(`Starting ${Q} for collection ${X} (dryRun=${$})`);let K=await yJ(X),H=await UJ(X)||{saveDir:"docs",mappings:[]};_J(K,H);async function z(W,j){if(!W.file){let B=C(W.title||"untitled"),L=j?M.join(j,B):M.join(H.saveDir||"docs",B);W.file=M.join(L,"README.md")}else{let B=M.dirname(W.file);if(!B||B==="."){let L=j||H.saveDir||"docs";W.file=M.join(L,W.file)}}let q=M.dirname(W.file);if(!$)try{await m.mkdir(q,{recursive:!0}),Z.debug(`Ensured directory ${q}`)}catch(B){Z.warn(`Failed to ensure directory ${q}: ${B}`)}else Z.debug(`[dry-run] would ensure directory ${q}`);let V=M.dirname(W.file);if(W.children?.length)for(let B of W.children)await z(B,V)}for(let W of K.pages)await z(W,null);Z.debug("Completed path normalization for manifest");for(let W of K.pages)await KJ(X,K,W,null,{mode:Q,dryRun:$});await xJ(X,K,$),Z.info("Done.")}var vJ=S(async()=>{await r();await HJ();await ZJ();await N()});var WJ,RJ=!1,A,v,Z,iJ,TJ,tJ,lJ,k,I,i;var N=S(async()=>{VJ();WJ=process.argv.slice(2),A={},v=[];for(let J=0;J<WJ.length;J++){let X=WJ[J];if(X==="--help"||X==="-h")v.push("--help");else if(X==="--verbose")v.push("--verbose");else if(X.startsWith("--collection=")||X.startsWith("--collection:")){let Q=X.split(/[:=]/)[1]||"";if(!A.collection)A.collection=[];A.collection.push(Q)}else if(X==="--collection"){let Q=WJ[J+1];if(Q&&!Q.startsWith("--")){if(!A.collection)A.collection=[];A.collection.push(Q),J++}}else if(X.startsWith("--")){let[Q,$]=X.replace(/^--/,"").split("=");A[Q]=$===void 0?!0:$}else v.push(X)}if(A["api-key"])process.env.OUTLINE_API_KEY=String(A["api-key"]);if(A["base-url"])process.env.OUTLINE_BASE_URL=String(A["base-url"]);if(v.includes("--verbose"))RJ=!0;Z=new f({level:RJ?"DEBUG":"INFO"});if(v.includes("--help")||A.help||A.h)console.log(`
Usage:
  OUTLINE_API_KEY=... bun run bin/cli.ts [command] [--collection=ID]... [--dry-run] [--api-key="..."]

Commands:
  setup                    - interactive setup: list collections, choose one
  list-collections         - print collections
  init --collection=ID     - bootstrap pages.json + markdown (repeatable)
  pull --collection=ID     - pull remote changes (repeatable)
  push --collection=ID     - push local changes (repeatable)
  sync --collection=ID     - bidirectional sync (repeatable)

Flags:
  --collection=ID          Repeatable; run command against multiple collections
  --api-key="..."          Provide Outline API key (overrides env var)
  --base-url="..."         Provide Outline base URL (overrides env var)
  --dry-run                Preview only
  --help, -h
Examples:
  OUTLINE_API_KEY=... bunx @dockstat/outline-sync --collection="id1" --collection="id2" sync --dry-run
  bun run bin/cli.ts sync --api-key="sk_xxx" --collection="id1"
`),process.exit(0);({loadTopConfig:iJ}=await MJ().then(() => BJ)),{listCollectionsPrompt:TJ,bootstrapCollection:tJ}=await OJ().then(() => EJ),{runSync:lJ}=await vJ().then(() => bJ);Z.debug("Parsing positionals");k=v[0]||"sync",I=Boolean(A["dry-run"]),i=A.collection??[];Z.debug(`Parsed cmd=${k} DRY_RUN=${I} collectionsFromCli=${i}`);try{Z.debug("Loading top config");let J=await iJ()||{collections:[]};Z.debug(`Loaded: ${JSON.stringify(J)}`);let X=()=>{if(Z.debug("Resolving targets"),i.length>0)return Z.debug(`Found Collection from cli: ${JSON.stringify(i)}`),i;if(J.collections&&J.collections.length>0)return Z.debug(`Found collections in Top Config: ${JSON.stringify(J)}`),J.collections.map((Q)=>Q.id);return Z.warn("Couldn't resolve targets"),[]};if(k==="list-collections")Z.debug("Listing collections"),await TJ({dryRun:I,nonInteractive:!1}),process.exit(0);if(k==="setup")Z.debug("Running setup"),await TJ({dryRun:I,nonInteractive:!1}),process.exit(0);if(k==="init"){Z.debug("Running init");let Q=X();if(!Q.length)throw new Error("Init requires at least one collection. Provide --collection or run setup.");for(let $ of Q)await tJ({collectionId:$,dryRun:I});process.exit(0)}if(k==="pull"||k==="push"||k==="sync"){Z.debug("Parsing CMD (pull/push/sync)");let Q=X();if(!Q.length)throw new Error(`Command "${k}" requires at least one collection id. Provide with --collection=ID or run setup.`);let $=k==="pull"?"pull":k==="push"?"push":"sync";for(let K of Q)await lJ({collectionId:K,mode:$,dryRun:I});process.exit(0)}Z.error(`Unknown command: ${k}`),process.exit(1)}catch(J){console.error("ERROR:",J?.message||J),process.exit(1)}});await N();export{Z as logger};

//# debugId=C9F1296C2DE7230364756E2164756E21
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vbGliL2xvZ2dlci50cyIsICIuLi9saWIvY29uZmlnLnRzIiwgIi4uL2xpYi9jb25maWcudHMiLCAiLi4vbGliL291dGxpbmVBcGkudHMiLCAiLi4vbGliL3V0aWxzLnRzIiwgIi4uL2xpYi9pbml0LnRzIiwgIi4uL2xpYi9zeW5jRW5naW5lLnRzIiwgIi4uL2Jpbi9jbGkudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbCiAgICAiZXhwb3J0IHR5cGUgTG9nTGV2ZWwgPSBcIkRFQlVHXCIgfCBcIklORk9cIiB8IFwiV0FSTlwiIHwgXCJFUlJPUlwiIHwgXCJOT05FXCI7XG5cbmNvbnN0IExFVkVMX09SREVSOiBSZWNvcmQ8TG9nTGV2ZWwsIG51bWJlcj4gPSB7XG4gIERFQlVHOiAwLFxuICBJTkZPOiAxLFxuICBXQVJOOiAyLFxuICBFUlJPUjogMyxcbiAgTk9ORTogNCxcbn07XG5cbmNvbnN0IEFOU0kgPSB7XG4gIHJlc2V0OiBcIlxceDFiWzBtXCIsXG4gIGJvbGQ6IFwiXFx4MWJbMW1cIixcbiAgZGltOiBcIlxceDFiWzJtXCIsXG4gIGRlYnVnOiBcIlxceDFiWzM2bVwiLCAvLyBjeWFuXG4gIGluZm86IFwiXFx4MWJbMzJtXCIsIC8vIGdyZWVuXG4gIHdhcm46IFwiXFx4MWJbMzNtXCIsIC8vIHllbGxvd1xuICBlcnJvcjogXCJcXHgxYlszMW1cIiwgLy8gcmVkXG4gIGdyYXk6IFwiXFx4MWJbOTBtXCIsXG59O1xuXG5leHBvcnQgY2xhc3MgTG9nZ2VyIHtcbiAgcHJpdmF0ZSBtaW5MZXZlbDogTG9nTGV2ZWw7XG4gIHByaXZhdGUgY29sb3JzOiBib29sZWFuO1xuICBwcml2YXRlIHNob3dUaW1lc3RhbXA6IGJvb2xlYW47XG4gIHByaXZhdGUgbmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogbmV3IExvZ2dlcih7IGxldmVsOiAnREVCVUcnLCBjb2xvcnM6IHRydWUsIHRpbWVzdGFtcDogdHJ1ZSwgbmFtZTogJ2FwaScgfSlcbiAgICovXG4gIGNvbnN0cnVjdG9yKG9wdHM/OiB7XG4gICAgbGV2ZWw/OiBMb2dMZXZlbDtcbiAgICBjb2xvcnM/OiBib29sZWFuOyAvLyBhbGxvdyBmb3JjaW5nIG9uL29mZlxuICAgIHRpbWVzdGFtcD86IGJvb2xlYW47XG4gICAgbmFtZT86IHN0cmluZzsgLy8gb3B0aW9uYWwgbG9nZ2VyIG5hbWUgZS5nLiBcImFwaVwiXG4gIH0pIHtcbiAgICBjb25zdCB7XG4gICAgICBsZXZlbCA9IFwiSU5GT1wiLFxuICAgICAgY29sb3JzID0gdHJ1ZSxcbiAgICAgIHRpbWVzdGFtcCA9IHRydWUsXG4gICAgICBuYW1lLFxuICAgIH0gPSBvcHRzID8/IHt9O1xuXG4gICAgdGhpcy5taW5MZXZlbCA9IGxldmVsO1xuICAgIHRoaXMuc2hvd1RpbWVzdGFtcCA9IHRpbWVzdGFtcDtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuXG4gICAgLy8gYXV0by1kZXRlY3QgaWYgd2Ugc2hvdWxkIGNvbG9yaXplOiByZXNwZWN0IE5PX0NPTE9SIGFuZCBub24tdHR5IChDSSlcbiAgICBjb25zdCBlbnZOb0NvbG9yID0gdHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgISFwcm9jZXNzLmVudi5OT19DT0xPUjtcbiAgICBjb25zdCBpc1RUWSA9XG4gICAgICB0eXBlb2YgcHJvY2VzcyAhPT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgICAgISFwcm9jZXNzLnN0ZG91dCAmJlxuICAgICAgISFwcm9jZXNzLnN0ZG91dC5pc1RUWTtcbiAgICB0aGlzLmNvbG9ycyA9IGNvbG9ycyAmJiAhZW52Tm9Db2xvciAmJiBpc1RUWTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkTG9nKGxldmVsOiBMb2dMZXZlbCkge1xuICAgIHJldHVybiAoXG4gICAgICBMRVZFTF9PUkRFUltsZXZlbF0gPj0gMCAmJlxuICAgICAgTEVWRUxfT1JERVJbbGV2ZWxdID49IExFVkVMX09SREVSW3RoaXMubWluTGV2ZWxdICYmXG4gICAgICBMRVZFTF9PUkRFUlt0aGlzLm1pbkxldmVsXSA8IExFVkVMX09SREVSLk5PTkVcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBsZXZlbE1ldGEobGV2ZWw6IEV4Y2x1ZGU8TG9nTGV2ZWwsIFwiTk9ORVwiPikge1xuICAgIHN3aXRjaCAobGV2ZWwpIHtcbiAgICAgIGNhc2UgXCJERUJVR1wiOlxuICAgICAgICByZXR1cm4geyB0YWc6IFwiREVCVUdcIiwgY29sb3I6IEFOU0kuZGVidWcsIGVtb2ppOiBcIvCfkJtcIiB9O1xuICAgICAgY2FzZSBcIklORk9cIjpcbiAgICAgICAgcmV0dXJuIHsgdGFnOiBcIklORk9cIiwgY29sb3I6IEFOU0kuaW5mbywgZW1vamk6IFwi4oS577iPXCIgfTtcbiAgICAgIGNhc2UgXCJXQVJOXCI6XG4gICAgICAgIHJldHVybiB7IHRhZzogXCJXQVJOXCIsIGNvbG9yOiBBTlNJLndhcm4sIGVtb2ppOiBcIuKaoO+4j1wiIH07XG4gICAgICBjYXNlIFwiRVJST1JcIjpcbiAgICAgICAgcmV0dXJuIHsgdGFnOiBcIkVSUk9SXCIsIGNvbG9yOiBBTlNJLmVycm9yLCBlbW9qaTogXCLinYxcIiB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdGltZXN0YW1wKCkge1xuICAgIGlmICghdGhpcy5zaG93VGltZXN0YW1wKSByZXR1cm4gXCJcIjtcbiAgICAvLyBJU08tbGlrZSB3aXRoIG1zLCBvciBsZWF2ZSBzaG9ydCBsb2NhbCB0aW1lOlxuICAgIHJldHVybiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIH1cblxuICBwcml2YXRlIHBhZExldmVsVGFnKHRhZzogc3RyaW5nKSB7XG4gICAgLy8ga2VlcCB3aWR0aCBjb25zaXN0ZW50XG4gICAgcmV0dXJuIHRhZy5wYWRFbmQoNSwgXCIgXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBjb2xvcml6ZSh0ZXh0OiBzdHJpbmcsIGNvbG9yQ29kZT86IHN0cmluZykge1xuICAgIGlmICghdGhpcy5jb2xvcnMgfHwgIWNvbG9yQ29kZSkgcmV0dXJuIHRleHQ7XG4gICAgcmV0dXJuIGAke2NvbG9yQ29kZX0ke3RleHR9JHtBTlNJLnJlc2V0fWA7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdChsZXZlbDogRXhjbHVkZTxMb2dMZXZlbCwgXCJOT05FXCI+LCBtc2c6IHN0cmluZykge1xuICAgIGNvbnN0IG1ldGEgPSB0aGlzLmxldmVsTWV0YShsZXZlbCk7XG4gICAgY29uc3Qgd2hlbiA9IHRoaXMudGltZXN0YW1wKCk7XG4gICAgY29uc3QgbmFtZVBhcnQgPSB0aGlzLm5hbWUgPyBgWyR7dGhpcy5uYW1lfV0gYCA6IFwiXCI7XG4gICAgY29uc3QgbGV2ZWxUYWcgPSBgWyAke3RoaXMucGFkTGV2ZWxUYWcobWV0YS50YWcpfSBdYDtcbiAgICBjb25zdCBlbW9qaSA9IG1ldGEuZW1vamk7XG4gICAgaWYgKHRoaXMuY29sb3JzKSB7XG4gICAgICAvLyBDb2xvciBsZXZlbCB0YWcgYW5kIGRpbSB0aGUgdGltZXN0YW1wICsgbmFtZVxuICAgICAgY29uc3QgY29sb3JlZFRhZyA9IHRoaXMuY29sb3JpemUobGV2ZWxUYWcsIG1ldGEuY29sb3IpO1xuICAgICAgY29uc3QgZGltTWV0YSA9IHRoaXMuY29sb3JpemUod2hlbiA/IGAke3doZW59IGAgOiBcIlwiLCBBTlNJLmdyYXkpO1xuICAgICAgY29uc3QgZGltTmFtZSA9IHRoaXMuY29sb3JpemUobmFtZVBhcnQsIEFOU0kuZGltKTtcbiAgICAgIHJldHVybiBgJHtkaW1NZXRhfSR7ZGltTmFtZX0ke2NvbG9yZWRUYWd9ICR7ZW1vaml9ICR7bXNnfWA7XG4gICAgfVxuICAgIHJldHVybiBgJHt3aGVuID8gYCR7d2hlbn0gYCA6IFwiXCJ9JHtuYW1lUGFydH0ke2xldmVsVGFnfSAke2Vtb2ppfSAke21zZ31gO1xuICB9XG5cbiAgcHJpdmF0ZSB3cml0ZShsZXZlbDogRXhjbHVkZTxMb2dMZXZlbCwgXCJOT05FXCI+LCBtc2c6IHN0cmluZykge1xuICAgIGlmICghdGhpcy5zaG91bGRMb2cobGV2ZWwpKSByZXR1cm47XG5cbiAgICBjb25zdCBvdXQgPSB0aGlzLmZvcm1hdChsZXZlbCwgbXNnKTtcblxuICAgIHN3aXRjaCAobGV2ZWwpIHtcbiAgICAgIGNhc2UgXCJERUJVR1wiOlxuICAgICAgICByZXR1cm4gY29uc29sZS5kZWJ1ZyA/IGNvbnNvbGUuZGVidWcob3V0KSA6IGNvbnNvbGUubG9nKG91dCk7XG4gICAgICBjYXNlIFwiSU5GT1wiOlxuICAgICAgICByZXR1cm4gY29uc29sZS5pbmZvID8gY29uc29sZS5pbmZvKG91dCkgOiBjb25zb2xlLmxvZyhvdXQpO1xuICAgICAgY2FzZSBcIldBUk5cIjpcbiAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybiA/IGNvbnNvbGUud2FybihvdXQpIDogY29uc29sZS5sb2cob3V0KTtcbiAgICAgIGNhc2UgXCJFUlJPUlwiOlxuICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvciA/IGNvbnNvbGUuZXJyb3Iob3V0KSA6IGNvbnNvbGUubG9nKG91dCk7XG4gICAgfVxuICB9XG5cbiAgZGVidWcobXNnOiBzdHJpbmcpIHtcbiAgICB0aGlzLndyaXRlKFwiREVCVUdcIiwgbXNnKTtcbiAgfVxuICBpbmZvKG1zZzogc3RyaW5nKSB7XG4gICAgdGhpcy53cml0ZShcIklORk9cIiwgbXNnKTtcbiAgfVxuICB3YXJuKG1zZzogc3RyaW5nKSB7XG4gICAgdGhpcy53cml0ZShcIldBUk5cIiwgbXNnKTtcbiAgfVxuICBlcnJvcihtc2c6IHN0cmluZykge1xuICAgIHRoaXMud3JpdGUoXCJFUlJPUlwiLCBtc2cpO1xuICB9XG5cbiAgLyoqIFJldHVybiBhIGNoaWxkIGxvZ2dlciBzaGFyaW5nIG9wdGlvbnMgYnV0IHdpdGggYSBuYW1lICh1c2VmdWwgZm9yIG1vZHVsZXMpICovXG4gIGNoaWxkKG5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgTG9nZ2VyKHtcbiAgICAgIGxldmVsOiB0aGlzLm1pbkxldmVsLFxuICAgICAgY29sb3JzOiB0aGlzLmNvbG9ycyxcbiAgICAgIHRpbWVzdGFtcDogdGhpcy5zaG93VGltZXN0YW1wLFxuICAgICAgbmFtZSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBVcGRhdGUgbWluaW11bSBsZXZlbCBhdCBydW50aW1lICovXG4gIHNldExldmVsKGxldmVsOiBMb2dMZXZlbCkge1xuICAgIHRoaXMubWluTGV2ZWwgPSBsZXZlbDtcbiAgfVxufVxuIiwKICAgICJpbXBvcnQgZnMgZnJvbSBcIm5vZGU6ZnMvcHJvbWlzZXNcIjtcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tIFwibm9kZTpmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcIm5vZGU6cGF0aFwiO1xuaW1wb3J0IHR5cGUgeyBUb3BDb25maWcsIFRvcENvbGxlY3Rpb25Db25maWcsIENvbGxlY3Rpb25Db25maWcgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIi4uL2Jpbi9jbGlcIjtcblxuZXhwb3J0IGNvbnN0IFRPUF9DT05GSUdfRklMRSA9IHBhdGguam9pbihcIm91dGxpbmUtc3luYy5qc29uXCIpO1xuXG5leHBvcnQgY29uc3Qgc2xlZXAgPSAobXM6IG51bWJlcikgPT4gbmV3IFByb21pc2UoKHIpID0+IHNldFRpbWVvdXQociwgbXMpKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZUNvbmZpZ0RpcihkaXI6IHN0cmluZykge1xuICBsb2dnZXIuZGVidWcoYEVuc3VyaW5nIGNvbmZpZyBkaXI6ICR7ZGlyfWApO1xuICBpZiAoIWV4aXN0c1N5bmMoZGlyKSkge1xuICAgIGxvZ2dlci53YXJuKGBEaXIgKCR7ZGlyfSkgZG9lcyBub3QgZXhpc3QsIGNyZWF0aW5nLi4uYCk7XG4gICAgYXdhaXQgZnMubWtkaXIoZGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlQ29uZmlnRGlycyhjZmc6IFRvcENvbmZpZykge1xuICBjb25zdCBjb2xsZWN0aW9ucyA9IGNmZy5jb2xsZWN0aW9ucztcbiAgY29uc29sZS5kZWJ1ZyhgRW5zdXJpbmcgY29uZmlnIGRpciBmb3IgJHtjb2xsZWN0aW9ucy5sZW5ndGh9IGNvbGxlY3Rpb24ocylgKTtcbiAgZm9yIChjb25zdCBjb2xsZWN0aW9uIG9mIGNvbGxlY3Rpb25zKSB7XG4gICAgY29uc3QgZGlyID0gY29sbGVjdGlvbi5jb25maWdEaXI7XG4gICAgbG9nZ2VyLmRlYnVnKGBFbnN1cmluZyBjb25maWcgZGlyOiAke2Rpcn1gKTtcbiAgICBpZiAoIWV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgbG9nZ2VyLndhcm4oYERpciAoJHtkaXJ9KSBkb2VzIG5vdCBleGlzdCwgY3JlYXRpbmcuLi5gKTtcbiAgICAgIGF3YWl0IGZzLm1rZGlyKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkVG9wQ29uZmlnKCk6IFByb21pc2U8VG9wQ29uZmlnIHwgbnVsbD4ge1xuICBsb2dnZXIuZGVidWcoYExvYWRpbmcgdG9wIGNvbmZpZyBmcm9tOiAke1RPUF9DT05GSUdfRklMRX1gKTtcbiAgaWYgKCFleGlzdHNTeW5jKFRPUF9DT05GSUdfRklMRSkpIHtcbiAgICBsb2dnZXIud2FybihcIlRvcCBjb25maWcgZmlsZSBub3QgZm91bmRcIik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgcmF3ID0gYXdhaXQgZnMucmVhZEZpbGUoVE9QX0NPTkZJR19GSUxFLCBcInV0ZjhcIik7XG4gIHJldHVybiBKU09OLnBhcnNlKHJhdykgYXMgVG9wQ29uZmlnO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2F2ZVRvcENvbmZpZyhjZmc6IFRvcENvbmZpZykge1xuICBsb2dnZXIuZGVidWcoXCJTYXZpbmcgdG9wIGNvbmZpZ1wiKTtcbiAgYXdhaXQgZW5zdXJlQ29uZmlnRGlycyhjZmcpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUoXG4gICAgVE9QX0NPTkZJR19GSUxFLFxuICAgIGAke0pTT04uc3RyaW5naWZ5KGNmZywgbnVsbCwgMil9XFxuYCxcbiAgICBcInV0ZjhcIixcbiAgKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbGxlY3Rpb25GaWxlc0Jhc2UoY29sbGVjdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgcGFnZXNGaWxlOiBzdHJpbmc7XG4gIGNvbmZpZ0ZpbGU6IHN0cmluZztcbiAgc2F2ZURpcjogc3RyaW5nO1xuICBjb25maWdEaXI6IHN0cmluZztcbn0+IHtcbiAgbG9nZ2VyLmRlYnVnKFwiR2V0dGluZyBDb2xsZWN0aW9uIGZpbGUgYmFzZVwiKTtcbiAgY29uc3QgdG9wQ29uZmlnID0gYXdhaXQgbG9hZFRvcENvbmZpZygpO1xuICBjb25zdCBDT05GSUdfRElSID0gdG9wQ29uZmlnLmNvbGxlY3Rpb25zLmZpbmQoXG4gICAgKGNvbGxlY3Rpb24pID0+IGNvbGxlY3Rpb24uaWQgPT09IGNvbGxlY3Rpb25JZCxcbiAgKS5jb25maWdEaXI7XG5cbiAgLy8gSWYgbm8gdG9wIGNvbmZpZyBleGlzdHMsIHVzZSBkZWZhdWx0IHBhdGhzXG4gIGlmICghdG9wQ29uZmlnIHx8ICF0b3BDb25maWcuY29sbGVjdGlvbnMpIHtcbiAgICBsb2dnZXIud2FybihgTm8gVG9wIGNvbmZpZyBmb3VuZCBmb3IgJHtjb2xsZWN0aW9uSWR9LCByZXR1cm5pbmcgZGVmYXVsdGApO1xuICAgIHJldHVybiB7XG4gICAgICBwYWdlc0ZpbGU6IHBhdGguam9pbihDT05GSUdfRElSLCBgJHtjb2xsZWN0aW9uSWR9LnBhZ2VzLmpzb25gKSxcbiAgICAgIGNvbmZpZ0ZpbGU6IHBhdGguam9pbihDT05GSUdfRElSLCBgJHtjb2xsZWN0aW9uSWR9LmNvbmZpZy5qc29uYCksXG4gICAgICBzYXZlRGlyOiBcImRvY3NcIixcbiAgICAgIGNvbmZpZ0RpcjogQ09ORklHX0RJUixcbiAgICB9O1xuICB9XG5cbiAgLy8gRmluZCB0aGUgY29sbGVjdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IGNvbGxlY3Rpb25Db25maWcgPSB0b3BDb25maWcuY29sbGVjdGlvbnMuZmluZChcbiAgICAoYykgPT4gYy5pZCA9PT0gY29sbGVjdGlvbklkLFxuICApO1xuXG4gIC8vIElmIG5vIHNwZWNpZmljIGNvbGxlY3Rpb24gY29uZmlnIGZvdW5kLCB1c2UgZGVmYXVsdCBwYXRoc1xuICBpZiAoIWNvbGxlY3Rpb25Db25maWcpIHtcbiAgICBsb2dnZXIud2FybihcbiAgICAgIGBDb2xsZWN0aW9uIGNvbmZpZyBmb3IgJHtjb2xsZWN0aW9uSWR9IG5vdCBmb3VuZCwgcmV0dXJuaW5nIGRlZmF1bHQgcGF0aHNgLFxuICAgICk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhZ2VzRmlsZTogcGF0aC5qb2luKENPTkZJR19ESVIsIGAke2NvbGxlY3Rpb25JZH0ucGFnZXMuanNvbmApLFxuICAgICAgY29uZmlnRmlsZTogcGF0aC5qb2luKENPTkZJR19ESVIsIGAke2NvbGxlY3Rpb25JZH0uY29uZmlnLmpzb25gKSxcbiAgICAgIHNhdmVEaXI6IFwiZG9jc1wiLFxuICAgICAgY29uZmlnRGlyOiBcIi5jb25maWdcIixcbiAgICB9O1xuICB9XG5cbiAgLy8gVXNlIGN1c3RvbSBwYXRocyBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0byBkZWZhdWx0c1xuICByZXR1cm4ge1xuICAgIHBhZ2VzRmlsZTpcbiAgICAgIGNvbGxlY3Rpb25Db25maWcucGFnZXNGaWxlIHx8XG4gICAgICBwYXRoLmpvaW4oQ09ORklHX0RJUiwgYCR7Y29sbGVjdGlvbklkfS5wYWdlcy5qc29uYCksXG4gICAgY29uZmlnRmlsZTpcbiAgICAgIGNvbGxlY3Rpb25Db25maWcuY29uZmlnRmlsZSB8fFxuICAgICAgcGF0aC5qb2luKENPTkZJR19ESVIsIGAke2NvbGxlY3Rpb25JZH0uY29uZmlnLmpzb25gKSxcbiAgICBzYXZlRGlyOiBjb2xsZWN0aW9uQ29uZmlnLnNhdmVEaXIgfHwgXCJkb2NzXCIsXG4gICAgY29uZmlnRGlyOiBjb2xsZWN0aW9uQ29uZmlnLmNvbmZpZ0RpciB8fCBcIi5jb25maWdcIixcbiAgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRDb2xsZWN0aW9uQ29uZmlnKFxuICBjb2xsZWN0aW9uSWQ6IHN0cmluZyxcbik6IFByb21pc2U8Q29sbGVjdGlvbkNvbmZpZyB8IG51bGw+IHtcbiAgbG9nZ2VyLmRlYnVnKGBMb2FkaW5nIGNvbGxlY3Rpb24gY29uZmlnIGZvciAke2NvbGxlY3Rpb25JZH1gKTtcbiAgY29uc3QgeyBjb25maWdGaWxlIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9uRmlsZXNCYXNlKGNvbGxlY3Rpb25JZCk7XG4gIGlmICghZXhpc3RzU3luYyhjb25maWdGaWxlKSkge1xuICAgIGxvZ2dlci53YXJuKGBDb2xsZWN0aW9uIGNvbmZpZyBmaWxlIGZvciAke2NvbGxlY3Rpb25JZH0gbm90IGZvdW5kYCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgcmF3ID0gYXdhaXQgZnMucmVhZEZpbGUoY29uZmlnRmlsZSwgXCJ1dGY4XCIpO1xuICByZXR1cm4gSlNPTi5wYXJzZShyYXcpIGFzIENvbGxlY3Rpb25Db25maWc7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDb2xsZWN0aW9uVG9wQ29uZmlnKFxuICBjb2xsZWN0aW9uSWQ6IHN0cmluZyxcbik6IFByb21pc2U8VG9wQ29sbGVjdGlvbkNvbmZpZyB8IG51bGw+IHtcbiAgbG9nZ2VyLmRlYnVnKGBHZXR0aW5nIFRvcCBDb2xsZWN0aW9uIENvbmZpZyBmb3IgJHtjb2xsZWN0aW9uSWR9YCk7XG4gIGNvbnN0IHRvcENvbmZpZyA9IGF3YWl0IGxvYWRUb3BDb25maWcoKTtcbiAgaWYgKCF0b3BDb25maWcgfHwgIXRvcENvbmZpZy5jb2xsZWN0aW9ucykge1xuICAgIGxvZ2dlci5kZWJ1ZyhgTm8gVG9wIENvbmZpZyBmb3VuZCBmb3IgJHtjb2xsZWN0aW9uSWR9YCk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgcmV0dXJuIHRvcENvbmZpZy5jb2xsZWN0aW9ucy5maW5kKChjKSA9PiBjLmlkID09PSBjb2xsZWN0aW9uSWQpIHx8IG51bGw7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlQ29sbGVjdGlvbkNvbmZpZyhjOiBDb2xsZWN0aW9uQ29uZmlnKSB7XG4gIGxvZ2dlci5kZWJ1ZyhgU2F2aW5nIENvbGxlY3Rpb24gY29uZmlnIGZvciAke2MuY29sbGVjdGlvbklkfWApO1xuICBjb25zdCB7IGNvbmZpZ0ZpbGUsIGNvbmZpZ0RpciB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbkZpbGVzQmFzZShcbiAgICBjLmNvbGxlY3Rpb25JZCxcbiAgKTtcbiAgYXdhaXQgZW5zdXJlQ29uZmlnRGlyKGNvbmZpZ0Rpcik7XG4gIGF3YWl0IGZzLndyaXRlRmlsZShjb25maWdGaWxlLCBgJHtKU09OLnN0cmluZ2lmeShjLCBudWxsLCAyKX1cXG5gLCBcInV0ZjhcIik7XG59XG4iLAogICAgImltcG9ydCBmcyBmcm9tIFwibm9kZTpmcy9wcm9taXNlc1wiO1xuaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XG5pbXBvcnQgdHlwZSB7IFRvcENvbmZpZywgVG9wQ29sbGVjdGlvbkNvbmZpZywgQ29sbGVjdGlvbkNvbmZpZyB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tIFwiLi4vYmluL2NsaVwiO1xuXG5leHBvcnQgY29uc3QgVE9QX0NPTkZJR19GSUxFID0gcGF0aC5qb2luKFwib3V0bGluZS1zeW5jLmpzb25cIik7XG5cbmV4cG9ydCBjb25zdCBzbGVlcCA9IChtczogbnVtYmVyKSA9PiBuZXcgUHJvbWlzZSgocikgPT4gc2V0VGltZW91dChyLCBtcykpO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlQ29uZmlnRGlyKGRpcjogc3RyaW5nKSB7XG4gIGxvZ2dlci5kZWJ1ZyhgRW5zdXJpbmcgY29uZmlnIGRpcjogJHtkaXJ9YCk7XG4gIGlmICghZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgbG9nZ2VyLndhcm4oYERpciAoJHtkaXJ9KSBkb2VzIG5vdCBleGlzdCwgY3JlYXRpbmcuLi5gKTtcbiAgICBhd2FpdCBmcy5ta2RpcihkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbnN1cmVDb25maWdEaXJzKGNmZzogVG9wQ29uZmlnKSB7XG4gIGNvbnN0IGNvbGxlY3Rpb25zID0gY2ZnLmNvbGxlY3Rpb25zO1xuICBjb25zb2xlLmRlYnVnKGBFbnN1cmluZyBjb25maWcgZGlyIGZvciAke2NvbGxlY3Rpb25zLmxlbmd0aH0gY29sbGVjdGlvbihzKWApO1xuICBmb3IgKGNvbnN0IGNvbGxlY3Rpb24gb2YgY29sbGVjdGlvbnMpIHtcbiAgICBjb25zdCBkaXIgPSBjb2xsZWN0aW9uLmNvbmZpZ0RpcjtcbiAgICBsb2dnZXIuZGVidWcoYEVuc3VyaW5nIGNvbmZpZyBkaXI6ICR7ZGlyfWApO1xuICAgIGlmICghZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgICBsb2dnZXIud2FybihgRGlyICgke2Rpcn0pIGRvZXMgbm90IGV4aXN0LCBjcmVhdGluZy4uLmApO1xuICAgICAgYXdhaXQgZnMubWtkaXIoZGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRUb3BDb25maWcoKTogUHJvbWlzZTxUb3BDb25maWcgfCBudWxsPiB7XG4gIGxvZ2dlci5kZWJ1ZyhgTG9hZGluZyB0b3AgY29uZmlnIGZyb206ICR7VE9QX0NPTkZJR19GSUxFfWApO1xuICBpZiAoIWV4aXN0c1N5bmMoVE9QX0NPTkZJR19GSUxFKSkge1xuICAgIGxvZ2dlci53YXJuKFwiVG9wIGNvbmZpZyBmaWxlIG5vdCBmb3VuZFwiKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCByYXcgPSBhd2FpdCBmcy5yZWFkRmlsZShUT1BfQ09ORklHX0ZJTEUsIFwidXRmOFwiKTtcbiAgcmV0dXJuIEpTT04ucGFyc2UocmF3KSBhcyBUb3BDb25maWc7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzYXZlVG9wQ29uZmlnKGNmZzogVG9wQ29uZmlnKSB7XG4gIGxvZ2dlci5kZWJ1ZyhcIlNhdmluZyB0b3AgY29uZmlnXCIpO1xuICBhd2FpdCBlbnN1cmVDb25maWdEaXJzKGNmZyk7XG4gIGF3YWl0IGZzLndyaXRlRmlsZShcbiAgICBUT1BfQ09ORklHX0ZJTEUsXG4gICAgYCR7SlNPTi5zdHJpbmdpZnkoY2ZnLCBudWxsLCAyKX1cXG5gLFxuICAgIFwidXRmOFwiLFxuICApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29sbGVjdGlvbkZpbGVzQmFzZShjb2xsZWN0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8e1xuICBwYWdlc0ZpbGU6IHN0cmluZztcbiAgY29uZmlnRmlsZTogc3RyaW5nO1xuICBzYXZlRGlyOiBzdHJpbmc7XG4gIGNvbmZpZ0Rpcjogc3RyaW5nO1xufT4ge1xuICBsb2dnZXIuZGVidWcoXCJHZXR0aW5nIENvbGxlY3Rpb24gZmlsZSBiYXNlXCIpO1xuICBjb25zdCB0b3BDb25maWcgPSBhd2FpdCBsb2FkVG9wQ29uZmlnKCk7XG4gIGNvbnN0IENPTkZJR19ESVIgPSB0b3BDb25maWcuY29sbGVjdGlvbnMuZmluZChcbiAgICAoY29sbGVjdGlvbikgPT4gY29sbGVjdGlvbi5pZCA9PT0gY29sbGVjdGlvbklkLFxuICApLmNvbmZpZ0RpcjtcblxuICAvLyBJZiBubyB0b3AgY29uZmlnIGV4aXN0cywgdXNlIGRlZmF1bHQgcGF0aHNcbiAgaWYgKCF0b3BDb25maWcgfHwgIXRvcENvbmZpZy5jb2xsZWN0aW9ucykge1xuICAgIGxvZ2dlci53YXJuKGBObyBUb3AgY29uZmlnIGZvdW5kIGZvciAke2NvbGxlY3Rpb25JZH0sIHJldHVybmluZyBkZWZhdWx0YCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhZ2VzRmlsZTogcGF0aC5qb2luKENPTkZJR19ESVIsIGAke2NvbGxlY3Rpb25JZH0ucGFnZXMuanNvbmApLFxuICAgICAgY29uZmlnRmlsZTogcGF0aC5qb2luKENPTkZJR19ESVIsIGAke2NvbGxlY3Rpb25JZH0uY29uZmlnLmpzb25gKSxcbiAgICAgIHNhdmVEaXI6IFwiZG9jc1wiLFxuICAgICAgY29uZmlnRGlyOiBDT05GSUdfRElSLFxuICAgIH07XG4gIH1cblxuICAvLyBGaW5kIHRoZSBjb2xsZWN0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3QgY29sbGVjdGlvbkNvbmZpZyA9IHRvcENvbmZpZy5jb2xsZWN0aW9ucy5maW5kKFxuICAgIChjKSA9PiBjLmlkID09PSBjb2xsZWN0aW9uSWQsXG4gICk7XG5cbiAgLy8gSWYgbm8gc3BlY2lmaWMgY29sbGVjdGlvbiBjb25maWcgZm91bmQsIHVzZSBkZWZhdWx0IHBhdGhzXG4gIGlmICghY29sbGVjdGlvbkNvbmZpZykge1xuICAgIGxvZ2dlci53YXJuKFxuICAgICAgYENvbGxlY3Rpb24gY29uZmlnIGZvciAke2NvbGxlY3Rpb25JZH0gbm90IGZvdW5kLCByZXR1cm5pbmcgZGVmYXVsdCBwYXRoc2AsXG4gICAgKTtcbiAgICByZXR1cm4ge1xuICAgICAgcGFnZXNGaWxlOiBwYXRoLmpvaW4oQ09ORklHX0RJUiwgYCR7Y29sbGVjdGlvbklkfS5wYWdlcy5qc29uYCksXG4gICAgICBjb25maWdGaWxlOiBwYXRoLmpvaW4oQ09ORklHX0RJUiwgYCR7Y29sbGVjdGlvbklkfS5jb25maWcuanNvbmApLFxuICAgICAgc2F2ZURpcjogXCJkb2NzXCIsXG4gICAgICBjb25maWdEaXI6IFwiLmNvbmZpZ1wiLFxuICAgIH07XG4gIH1cblxuICAvLyBVc2UgY3VzdG9tIHBhdGhzIGlmIHByb3ZpZGVkLCBvdGhlcndpc2UgZmFsbCBiYWNrIHRvIGRlZmF1bHRzXG4gIHJldHVybiB7XG4gICAgcGFnZXNGaWxlOlxuICAgICAgY29sbGVjdGlvbkNvbmZpZy5wYWdlc0ZpbGUgfHxcbiAgICAgIHBhdGguam9pbihDT05GSUdfRElSLCBgJHtjb2xsZWN0aW9uSWR9LnBhZ2VzLmpzb25gKSxcbiAgICBjb25maWdGaWxlOlxuICAgICAgY29sbGVjdGlvbkNvbmZpZy5jb25maWdGaWxlIHx8XG4gICAgICBwYXRoLmpvaW4oQ09ORklHX0RJUiwgYCR7Y29sbGVjdGlvbklkfS5jb25maWcuanNvbmApLFxuICAgIHNhdmVEaXI6IGNvbGxlY3Rpb25Db25maWcuc2F2ZURpciB8fCBcImRvY3NcIixcbiAgICBjb25maWdEaXI6IGNvbGxlY3Rpb25Db25maWcuY29uZmlnRGlyIHx8IFwiLmNvbmZpZ1wiLFxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZENvbGxlY3Rpb25Db25maWcoXG4gIGNvbGxlY3Rpb25JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxDb2xsZWN0aW9uQ29uZmlnIHwgbnVsbD4ge1xuICBsb2dnZXIuZGVidWcoYExvYWRpbmcgY29sbGVjdGlvbiBjb25maWcgZm9yICR7Y29sbGVjdGlvbklkfWApO1xuICBjb25zdCB7IGNvbmZpZ0ZpbGUgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25GaWxlc0Jhc2UoY29sbGVjdGlvbklkKTtcbiAgaWYgKCFleGlzdHNTeW5jKGNvbmZpZ0ZpbGUpKSB7XG4gICAgbG9nZ2VyLndhcm4oYENvbGxlY3Rpb24gY29uZmlnIGZpbGUgZm9yICR7Y29sbGVjdGlvbklkfSBub3QgZm91bmRgKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCByYXcgPSBhd2FpdCBmcy5yZWFkRmlsZShjb25maWdGaWxlLCBcInV0ZjhcIik7XG4gIHJldHVybiBKU09OLnBhcnNlKHJhdykgYXMgQ29sbGVjdGlvbkNvbmZpZztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENvbGxlY3Rpb25Ub3BDb25maWcoXG4gIGNvbGxlY3Rpb25JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxUb3BDb2xsZWN0aW9uQ29uZmlnIHwgbnVsbD4ge1xuICBsb2dnZXIuZGVidWcoYEdldHRpbmcgVG9wIENvbGxlY3Rpb24gQ29uZmlnIGZvciAke2NvbGxlY3Rpb25JZH1gKTtcbiAgY29uc3QgdG9wQ29uZmlnID0gYXdhaXQgbG9hZFRvcENvbmZpZygpO1xuICBpZiAoIXRvcENvbmZpZyB8fCAhdG9wQ29uZmlnLmNvbGxlY3Rpb25zKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBObyBUb3AgQ29uZmlnIGZvdW5kIGZvciAke2NvbGxlY3Rpb25JZH1gKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4gdG9wQ29uZmlnLmNvbGxlY3Rpb25zLmZpbmQoKGMpID0+IGMuaWQgPT09IGNvbGxlY3Rpb25JZCkgfHwgbnVsbDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmVDb2xsZWN0aW9uQ29uZmlnKGM6IENvbGxlY3Rpb25Db25maWcpIHtcbiAgbG9nZ2VyLmRlYnVnKGBTYXZpbmcgQ29sbGVjdGlvbiBjb25maWcgZm9yICR7Yy5jb2xsZWN0aW9uSWR9YCk7XG4gIGNvbnN0IHsgY29uZmlnRmlsZSwgY29uZmlnRGlyIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9uRmlsZXNCYXNlKFxuICAgIGMuY29sbGVjdGlvbklkLFxuICApO1xuICBhd2FpdCBlbnN1cmVDb25maWdEaXIoY29uZmlnRGlyKTtcbiAgYXdhaXQgZnMud3JpdGVGaWxlKGNvbmZpZ0ZpbGUsIGAke0pTT04uc3RyaW5naWZ5KGMsIG51bGwsIDIpfVxcbmAsIFwidXRmOFwiKTtcbn1cbiIsCiAgICAiaW1wb3J0IHsgc2xlZXAgfSBmcm9tIFwiLi9jb25maWdcIjtcbmNvbnN0IEJBU0VfVVJMID0gcHJvY2Vzcy5lbnYuT1VUTElORV9CQVNFX1VSTCB8fCBcImh0dHBzOi8vYXBwLmdldG91dGxpbmUuY29tXCI7XG5jb25zdCBBUElfS0VZID0gcHJvY2Vzcy5lbnYuT1VUTElORV9BUElfS0VZIHx8IFwiXCI7XG5jb25zdCBIRUFERVJTID0ge1xuICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7QVBJX0tFWX1gLFxuICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbn07XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCIuLi9iaW4vY2xpXCI7XG5cbi8qKlxuICogTWFrZSBhIFBPU1QgcmVxdWVzdCB0byB0aGUgT3V0bGluZSBBUEkgd2l0aCBzaW1wbGUgcmV0cnkvYmFja29mZiBsb2dpYy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gb3V0bGluZVJlcXVlc3QoXG4gIGVuZHBvaW50OiBzdHJpbmcsXG4gIGJvZHk6IGFueSxcbiAgcmV0cmllcyA9IDMsXG4pOiBQcm9taXNlPGFueT4ge1xuICBjb25zdCB1cmwgPSBgJHtCQVNFX1VSTH0vYXBpLyR7ZW5kcG9pbnR9YDtcblxuICBmb3IgKGxldCBhdHRlbXB0ID0gMDsgYXR0ZW1wdCA8IHJldHJpZXM7IGF0dGVtcHQrKykge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuZGVidWcoYE91dGxpbmUgcmVxdWVzdDogUE9TVCAke3VybH0gKGF0dGVtcHQgJHthdHRlbXB0ICsgMX0pYCk7XG4gICAgICBsb2dnZXIuZGVidWcoYFBheWxvYWQgKHRyaW1tZWQpOiAke0pTT04uc3RyaW5naWZ5KGJvZHksIG51bGwsIDIpfWApO1xuXG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgaGVhZGVyczogSEVBREVSUyxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IDQyOSkge1xuICAgICAgICBjb25zdCBiYWNrb2ZmID0gMTAwMCAqIChhdHRlbXB0ICsgMSk7XG4gICAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICAgIGBSYXRlIGxpbWl0ZWQgYnkgT3V0bGluZSBBUEkuIEJhY2tpbmcgb2ZmICR7YmFja29mZn1tcyAoYXR0ZW1wdCAke2F0dGVtcHQgKyAxfSkuYCxcbiAgICAgICAgKTtcbiAgICAgICAgYXdhaXQgc2xlZXAoYmFja29mZik7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBsZXQganNvbjogYW55O1xuICAgICAgdHJ5IHtcbiAgICAgICAganNvbiA9IGF3YWl0IHJlcy5qc29uKCk7XG4gICAgICB9IGNhdGNoIChwYXJzZUVycikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgYEZhaWxlZCB0byBwYXJzZSBKU09OIHJlc3BvbnNlIGZyb20gJHtlbmRwb2ludH06ICR7cGFyc2VFcnJ9YCxcbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgcGFyc2VFcnI7XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzLm9rKSB7XG4gICAgICAgIC8vIExvZyB1c2VmdWwgY29udGV4dCBidXQgYXZvaWQgbGVha2luZyBzZW5zaXRpdmUgaGVhZGVycy9rZXlzXG4gICAgICAgIGxvZ2dlci5lcnJvcihcbiAgICAgICAgICBgW091dGxpbmVAJHtCQVNFX1VSTH0vYXBpLyR7ZW5kcG9pbnR9XSBIVFRQICR7cmVzLnN0YXR1c30gLSBwYXlsb2FkPSR7SlNPTi5zdHJpbmdpZnkoYm9keSl9IHJlc3BvbnNlPSR7SlNPTi5zdHJpbmdpZnkoanNvbil9YCxcbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBPdXRsaW5lIEFQSSBlcnJvciAke3Jlcy5zdGF0dXN9OiAke0pTT04uc3RyaW5naWZ5KGpzb24pfWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgYE91dGxpbmUgcmVzcG9uc2UgZm9yICR7ZW5kcG9pbnR9IChhdHRlbXB0ICR7YXR0ZW1wdCArIDF9KTogJHtKU09OLnN0cmluZ2lmeShqc29uKS5zbGljZSgwLCAyMDApfSR7SlNPTi5zdHJpbmdpZnkoanNvbikubGVuZ3RoID4gMjAwID8gXCIuLi5cIiA6IFwiXCJ9YCxcbiAgICAgICk7XG4gICAgICByZXR1cm4ganNvbjtcbiAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgLy8gbGFzdCBhdHRlbXB0IC0+IHJldGhyb3dcbiAgICAgIGlmIChhdHRlbXB0ID09PSByZXRyaWVzIC0gMSkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgYFJlcXVlc3QgdG8gT3V0bGluZSBmYWlsZWQgYWZ0ZXIgJHtyZXRyaWVzfSBhdHRlbXB0czogJHtlcnI/Lm1lc3NhZ2UgPz8gZXJyfWAsXG4gICAgICAgICk7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGJhY2tvZmYgPSA1MDAgKiAoYXR0ZW1wdCArIDEpO1xuICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgIGBSZXF1ZXN0IGZhaWxlZCAoYXR0ZW1wdCAke2F0dGVtcHQgKyAxfSk6ICR7ZXJyPy5tZXNzYWdlID8/IGVycn0uIFJldHJ5aW5nIGFmdGVyICR7YmFja29mZn1tcy4uLmAsXG4gICAgICApO1xuICAgICAgYXdhaXQgc2xlZXAoYmFja29mZik7XG4gICAgfVxuICB9XG5cbiAgLy8gU2hvdWxkIGJlIHVucmVhY2hhYmxlLCBidXQga2VlcCB0aGUgZXJyb3IgZm9yIFR5cGVTY3JpcHRcbiAgdGhyb3cgbmV3IEVycm9yKFwib3V0bGluZVJlcXVlc3Q6IHVucmVhY2hhYmxlXCIpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdENvbGxlY3Rpb25zUGFnZWQoKTogUHJvbWlzZTxcbiAgeyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfVtdXG4+IHtcbiAgY29uc3Qgb3V0OiB7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZyB9W10gPSBbXTtcbiAgbGV0IG9mZnNldCA9IDA7XG4gIGNvbnN0IGxpbWl0ID0gMTAwO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIGNvbnN0IGpzb24gPSBhd2FpdCBvdXRsaW5lUmVxdWVzdChcImNvbGxlY3Rpb25zLmxpc3RcIiwgeyBvZmZzZXQsIGxpbWl0IH0pO1xuICAgIGNvbnN0IGRhdGEgPSBqc29uLmRhdGEgfHwgW107XG4gICAgZm9yIChjb25zdCBjIG9mIGRhdGEpIG91dC5wdXNoKHsgaWQ6IGMuaWQsIG5hbWU6IGMubmFtZSB9KTtcbiAgICBpZiAoZGF0YS5sZW5ndGggPCBsaW1pdCkgYnJlYWs7XG4gICAgb2Zmc2V0ICs9IGRhdGEubGVuZ3RoO1xuICB9XG4gIGxvZ2dlci5kZWJ1ZyhgbGlzdENvbGxlY3Rpb25zUGFnZWQ6IHJldHVybmVkICR7b3V0Lmxlbmd0aH0gY29sbGVjdGlvbnNgKTtcbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3REb2N1bWVudHNJbkNvbGxlY3Rpb24oXG4gIGNvbGxlY3Rpb25JZDogc3RyaW5nLFxuKTogUHJvbWlzZTxhbnlbXT4ge1xuICBjb25zdCBvdXQ6IGFueVtdID0gW107XG4gIGxldCBvZmZzZXQgPSAwO1xuICBjb25zdCBsaW1pdCA9IDEwMDtcbiAgd2hpbGUgKHRydWUpIHtcbiAgICBjb25zdCBqc29uID0gYXdhaXQgb3V0bGluZVJlcXVlc3QoXCJkb2N1bWVudHMubGlzdFwiLCB7XG4gICAgICBjb2xsZWN0aW9uSWQsXG4gICAgICBvZmZzZXQsXG4gICAgICBsaW1pdCxcbiAgICB9KTtcbiAgICBjb25zdCBkYXRhID0ganNvbi5kYXRhIHx8IFtdO1xuICAgIGZvciAoY29uc3QgZCBvZiBkYXRhKSBvdXQucHVzaChkKTtcbiAgICBpZiAoZGF0YS5sZW5ndGggPCBsaW1pdCkgYnJlYWs7XG4gICAgb2Zmc2V0ICs9IGRhdGEubGVuZ3RoO1xuICB9XG4gIGxvZ2dlci5kZWJ1ZyhcbiAgICBgbGlzdERvY3VtZW50c0luQ29sbGVjdGlvbigke2NvbGxlY3Rpb25JZH0pOiByZXR1cm5lZCAke291dC5sZW5ndGh9IGRvY3VtZW50c2AsXG4gICk7XG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaERvY3VtZW50SW5mbyhkb2N1bWVudElkOiBzdHJpbmcpIHtcbiAgY29uc3QganNvbiA9IGF3YWl0IG91dGxpbmVSZXF1ZXN0KFwiZG9jdW1lbnRzLmluZm9cIiwgeyBpZDogZG9jdW1lbnRJZCB9KTtcbiAgbG9nZ2VyLmRlYnVnKGBmZXRjaERvY3VtZW50SW5mbygke2RvY3VtZW50SWR9KSAtPiAke2pzb24gPyBcIm9rXCIgOiBcIm51bGxcIn1gKTtcbiAgcmV0dXJuIGpzb24uZGF0YSA/PyBudWxsO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlRG9jdW1lbnQoXG4gIHRpdGxlOiBzdHJpbmcsXG4gIHRleHQ6IHN0cmluZyxcbiAgY29sbGVjdGlvbklkOiBzdHJpbmcsXG4gIHBhcmVudERvY3VtZW50SWQ6IHN0cmluZyB8IG51bGwsXG4pIHtcbiAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICB0aXRsZSxcbiAgICB0ZXh0LFxuICAgIGNvbGxlY3Rpb25JZCxcbiAgICBwYXJlbnREb2N1bWVudElkOiBwYXJlbnREb2N1bWVudElkIHx8IG51bGwsXG4gICAgcHVibGlzaDogdHJ1ZSxcbiAgfTtcbiAgY29uc3QganNvbiA9IGF3YWl0IG91dGxpbmVSZXF1ZXN0KFwiZG9jdW1lbnRzLmNyZWF0ZVwiLCBwYXlsb2FkKTtcbiAgbG9nZ2VyLmluZm8oXG4gICAgYENyZWF0ZWQgZG9jdW1lbnQgXCIke3RpdGxlfVwiIGluIGNvbGxlY3Rpb24gJHtjb2xsZWN0aW9uSWR9IChpZD0ke2pzb24/LmlkID8/IFwidW5rbm93blwifSlgLFxuICApO1xuICByZXR1cm4ganNvbi5kYXRhO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRG9jdW1lbnQoXG4gIGlkOiBzdHJpbmcsXG4gIHRpdGxlOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gIHRleHQ6IHN0cmluZyxcbikge1xuICBjb25zdCBwYXlsb2FkOiBhbnkgPSB7IGlkLCB0ZXh0LCBwdWJsaXNoOiB0cnVlIH07XG4gIGlmICh0aXRsZSkgcGF5bG9hZC50aXRsZSA9IHRpdGxlO1xuICBjb25zdCBqc29uID0gYXdhaXQgb3V0bGluZVJlcXVlc3QoXCJkb2N1bWVudHMudXBkYXRlXCIsIHBheWxvYWQpO1xuICBsb2dnZXIuaW5mbyhgVXBkYXRlZCBkb2N1bWVudCBpZD0ke2lkfSR7dGl0bGUgPyBgIHRpdGxlPVwiJHt0aXRsZX1cImAgOiBcIlwifWApO1xuICByZXR1cm4ganNvbi5kYXRhO1xufVxuIiwKICAgICJpbXBvcnQgZnMgZnJvbSBcIm5vZGU6ZnMvcHJvbWlzZXNcIjtcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tIFwibm9kZTpmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcIm5vZGU6cGF0aFwiO1xuaW1wb3J0IHsgc3Bhd25TeW5jIH0gZnJvbSBcIm5vZGU6Y2hpbGRfcHJvY2Vzc1wiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIi4uL2Jpbi9jbGlcIjtcblxuLyoqXG4gKiBSZW1vdmUgQUxMIHdoaXRlc3BhY2UgKHNwYWNlLCB0YWIsIG5ld2xpbmUsIENSKSBmb3IgY29tcGFyaXNvbi5cbiAqIFRoaXMgbWFrZXMgZGlmZnMgdG9sZXJhbnQgdG8gZm9ybWF0dGluZyBkaWZmZXJlbmNlcy5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUNvbnRlbnRJZ25vcmVXaGl0ZXNwYWNlKHM6IHN0cmluZykge1xuICByZXR1cm4gcy5yZXBsYWNlKC9cXHMrL2csIFwiXCIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2x1Z2lmeVRpdGxlKHRpdGxlOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRpdGxlXG4gICAgLnRvU3RyaW5nKClcbiAgICAubm9ybWFsaXplKFwiTkZLRFwiKVxuICAgIC5yZXBsYWNlKC9cXHB7TX0vZ3UsIFwiXCIpXG4gICAgLnRvTG93ZXJDYXNlKClcbiAgICAucmVwbGFjZSgvW15hLXowLTldKy9nLCBcIi1cIilcbiAgICAucmVwbGFjZSgvKF4tfC0kKSsvZywgXCJcIilcbiAgICAuc2xpY2UoMCwgMTIwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEdpdFRpbWVzdGFtcE1zKGZpbGVQYXRoOiBzdHJpbmcpOiBudW1iZXIgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNvbHZlZCA9IHBhdGgucmVzb2x2ZShmaWxlUGF0aCk7XG4gICAgY29uc3Qgb3V0ID0gc3Bhd25TeW5jKFxuICAgICAgXCJnaXRcIixcbiAgICAgIFtcImxvZ1wiLCBcIi0xXCIsIFwiLS1mb3JtYXQ9JWN0XCIsIFwiLS1cIiwgcmVzb2x2ZWRdLFxuICAgICAge1xuICAgICAgICBjd2Q6IHByb2Nlc3MuY3dkKCksXG4gICAgICAgIGVuY29kaW5nOiBcInV0ZjhcIixcbiAgICAgIH0sXG4gICAgKTtcbiAgICBpZiAob3V0LnN0YXR1cyAhPT0gMCkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICBgZ2l0IGxvZyByZXR1cm5lZCBub24temVybyBzdGF0dXMgZm9yICR7cmVzb2x2ZWR9OiAke291dC5zdGF0dXN9YCxcbiAgICAgICk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgdHh0ID0gKG91dC5zdGRvdXQgfHwgXCJcIikudHJpbSgpO1xuICAgIGlmICghdHh0KSB7XG4gICAgICBsb2dnZXIuZGVidWcoYGdpdCBsb2cgcmV0dXJuZWQgbm8gb3V0cHV0IGZvciAke3Jlc29sdmVkfWApO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHNlYyA9IE51bWJlcih0eHQpO1xuICAgIGlmIChOdW1iZXIuaXNOYU4oc2VjKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBnaXQgbG9nIG91dHB1dCBub3QgYSBudW1iZXIgZm9yICR7cmVzb2x2ZWR9OiBcIiR7dHh0fVwiYCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHNlYyAqIDEwMDA7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5kZWJ1ZyhgZ2V0R2l0VGltZXN0YW1wTXMgZXJyb3IgZm9yICR7ZmlsZVBhdGh9OiAke2Vycn1gKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxUaW1lc3RhbXBNcyhmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgY29uc3QgZ2l0VHMgPSBnZXRHaXRUaW1lc3RhbXBNcyhmaWxlUGF0aCk7XG4gIGlmIChnaXRUcykge1xuICAgIGxvZ2dlci5kZWJ1ZyhgVXNpbmcgZ2l0IHRpbWVzdGFtcCBmb3IgJHtmaWxlUGF0aH06ICR7Z2l0VHN9YCk7XG4gICAgcmV0dXJuIGdpdFRzO1xuICB9XG4gIGNvbnN0IHN0ID0gYXdhaXQgZnMuc3RhdChmaWxlUGF0aCk7XG4gIGxvZ2dlci5kZWJ1ZyhgVXNpbmcgRlMgbXRpbWUgZm9yICR7ZmlsZVBhdGh9OiAke3N0Lm10aW1lTXN9YCk7XG4gIHJldHVybiBzdC5tdGltZU1zO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2FmZVdyaXRlRmlsZShcbiAgZmlsZVBhdGg6IHN0cmluZyxcbiAgY29udGVudDogc3RyaW5nLFxuICBkcnlSdW4gPSBmYWxzZSxcbikge1xuICBpZiAoZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcbiAgICBjb25zdCBiYWsgPSBgJHtmaWxlUGF0aH0ub3V0bGluZS1zeW5jLmJhay4ke0RhdGUubm93KCl9YDtcbiAgICBpZiAoIWRyeVJ1bikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnMuY29weUZpbGUoZmlsZVBhdGgsIGJhayk7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBCYWNrZWQgdXAgZXhpc3RpbmcgZmlsZSB0byAke2Jha31gKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2dnZXIud2FybihgRmFpbGVkIHRvIGJhY2sgdXAgJHtmaWxlUGF0aH0gdG8gJHtiYWt9OiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICBgW2RyeS1ydW5dIHdvdWxkIGJhY2t1cCBleGlzdGluZyBmaWxlICR7ZmlsZVBhdGh9IC0+ICR7YmFrfWAsXG4gICAgICApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoIWRyeVJ1bikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZnMubWtkaXIocGF0aC5kaXJuYW1lKGZpbGVQYXRoKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgRW5zdXJlZCBkaXJlY3RvcnkgJHtwYXRoLmRpcm5hbWUoZmlsZVBhdGgpfWApO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICAgIGBGYWlsZWQgdG8gY3JlYXRlIGRpcmVjdG9yeSAke3BhdGguZGlybmFtZShmaWxlUGF0aCl9OiAke2Vycn1gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgIGBbZHJ5LXJ1bl0gd291bGQgZW5zdXJlIGRpcmVjdG9yeSAke3BhdGguZGlybmFtZShmaWxlUGF0aCl9YCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFkcnlSdW4pIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMud3JpdGVGaWxlKGZpbGVQYXRoLCBjb250ZW50LCBcInV0ZjhcIik7XG4gICAgICBsb2dnZXIuaW5mbyhgV3JvdGUgZmlsZSAke2ZpbGVQYXRofSAoJHtjb250ZW50Lmxlbmd0aH0gYnl0ZXMpYCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEZhaWxlZCB0byB3cml0ZSBmaWxlICR7ZmlsZVBhdGh9OiAke2Vycn1gKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgYFtkcnktcnVuXSB3b3VsZCB3cml0ZSBmaWxlICR7ZmlsZVBhdGh9ICgke2NvbnRlbnQubGVuZ3RofSBieXRlcylgLFxuICAgICk7XG4gIH1cbn1cbiIsCiAgICAiaW1wb3J0IHsgbGlzdENvbGxlY3Rpb25zUGFnZWQsIGxpc3REb2N1bWVudHNJbkNvbGxlY3Rpb24gfSBmcm9tIFwiLi9vdXRsaW5lQXBpXCI7XG5pbXBvcnQge1xuICBsb2FkVG9wQ29uZmlnLFxuICBzYXZlVG9wQ29uZmlnLFxuICBnZXRDb2xsZWN0aW9uRmlsZXNCYXNlLFxuICBzYXZlQ29sbGVjdGlvbkNvbmZpZyxcbiAgZW5zdXJlQ29uZmlnRGlyLFxuICBlbnN1cmVDb25maWdEaXJzLFxufSBmcm9tIFwiLi9jb25maWdcIjtcbmltcG9ydCBmcyBmcm9tIFwibm9kZTpmcy9wcm9taXNlc1wiO1xuaW1wb3J0IHsgZXhpc3RzU3luYyB9IGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwibm9kZTpwYXRoXCI7XG5pbXBvcnQgeyBzbHVnaWZ5VGl0bGUgfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHR5cGUgeyBQYWdlRW50cnksIE1hbmlmZXN0IH0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gXCIuLi9iaW4vY2xpXCI7XG5cbi8qKlxuICogUHJvbXB0IGhlbHBlciAoc2ltcGxlKTogcHJpbnRzIG51bWJlcmVkIGxpc3QgYW5kIHJlYWRzIGEgbGluZSBmcm9tIHN0ZGluLlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdENvbGxlY3Rpb25zUHJvbXB0KG9wdHM6IHtcbiAgZHJ5UnVuPzogYm9vbGVhbjtcbiAgbm9uSW50ZXJhY3RpdmU/OiBib29sZWFuO1xufSkge1xuICBjb25zdCBjb2xzID0gYXdhaXQgbGlzdENvbGxlY3Rpb25zUGFnZWQoKTtcbiAgaWYgKCFjb2xzLmxlbmd0aCkge1xuICAgIGxvZ2dlci53YXJuKFwiTm8gY29sbGVjdGlvbnMgZm91bmQgZm9yIHRoaXMgQVBJIGtleS5cIik7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnNvbGUuaW5mbyhcIkNvbGxlY3Rpb25zOlwiKTtcbiAgY29scy5mb3JFYWNoKChjLCBpKSA9PiBjb25zb2xlLmluZm8oYCR7aSArIDF9KSAke2MuaWR9XFx0JHtjLm5hbWV9YCkpO1xuICBpZiAob3B0cy5ub25JbnRlcmFjdGl2ZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHNlbGVjdGlvbiA9IGF3YWl0IHF1ZXN0aW9uKFxuICAgIFwiU2VsZWN0IGEgY29sbGVjdGlvbiBieSBudW1iZXIgKG9yIHByZXNzIEVudGVyIHRvIGNhbmNlbCk6IFwiLFxuICApO1xuICBjb25zdCBpZHggPSBOdW1iZXIoc2VsZWN0aW9uLnRyaW0oKSk7XG4gIGlmICghaWR4IHx8IGlkeCA8IDEgfHwgaWR4ID4gY29scy5sZW5ndGgpIHtcbiAgICBsb2dnZXIud2FybihcIkNhbmNlbGxlZCBjb2xsZWN0aW9uIHNlbGVjdGlvbi5cIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgY2hvc2VuID0gY29sc1tpZHggLSAxXTtcbiAgbG9nZ2VyLmluZm8oYFlvdSBjaG9zZTogJHtjaG9zZW4ubmFtZX0gKCR7Y2hvc2VuLmlkfSlgKTtcblxuICBhd2FpdCBlbnN1cmVDb25maWdEaXJzKChhd2FpdCBsb2FkVG9wQ29uZmlnKCkpIHx8IHsgY29sbGVjdGlvbnM6IFtdIH0pO1xuICBjb25zdCB0b3AgPSAoYXdhaXQgbG9hZFRvcENvbmZpZygpKSB8fCB7IGNvbGxlY3Rpb25zOiBbXSB9O1xuICBjb25zdCBleGlzdHMgPSB0b3AuY29sbGVjdGlvbnMuZmluZCgoYykgPT4gYy5pZCA9PT0gY2hvc2VuLmlkKTtcblxuICBsZXQgY29uZmlnRGlyID0gKFxuICAgIGF3YWl0IHF1ZXN0aW9uKFxuICAgICAgXCJFbnRlciBhIGJhc2UgZm9sZGVyIHBhdGggZm9yIHRoZSBjb2xsZWN0aW9ucyBjb25maWcgZmlsZXMgKG9yIHByZXNzIGVudGVyIGZvciBkZWZhdWx0IGAuY29uZmlnYCk6IFwiLFxuICAgIClcbiAgKS5yZXBsYWNlQWxsKFwiXFxuXCIsIFwiXCIpO1xuXG4gIGlmIChjb25maWdEaXIudHJpbSgpLmxlbmd0aCA8PSAxKSB7XG4gICAgY29uZmlnRGlyID0gXCIuY29uZmlnXCI7XG4gICAgbG9nZ2VyLmRlYnVnKFwiVXNpbmcgZGVmYXVsdCBjb25maWdEaXIgYC5jb25maWdgXCIpO1xuICB9XG5cbiAgbGV0IHNhdmVEaXIgPSAoXG4gICAgYXdhaXQgcXVlc3Rpb24oXG4gICAgICBcIkVudGVyIGEgYmFzZSBmb2xkZXIgcGF0aCBmb3IgdGhlIGNvbGxlY3Rpb25zIG1hcmtkb3duIGZpbGVzIChvciBwcmVzcyBlbnRlciBmb3IgZGVmYXVsdCBgZG9jc2ApOiBcIixcbiAgICApXG4gICkucmVwbGFjZUFsbChcIlxcblwiLCBcIlwiKTtcblxuICBpZiAoc2F2ZURpci50cmltKCkubGVuZ3RoIDw9IDEpIHtcbiAgICBzYXZlRGlyID0gXCJkb2NzXCI7XG4gICAgbG9nZ2VyLmRlYnVnKFwiVXNpbmcgZGVmYXVsdCBzYXZlRGlyIGBkb2NzYFwiKTtcbiAgfVxuXG4gIGlmICghZXhpc3RzKSB7XG4gICAgdG9wLmNvbGxlY3Rpb25zLnVuc2hpZnQoe1xuICAgICAgaWQ6IGNob3Nlbi5pZCxcbiAgICAgIG5hbWU6IGNob3Nlbi5uYW1lLFxuICAgICAgY29uZmlnRGlyOiBjb25maWdEaXIsXG4gICAgICBzYXZlRGlyOiBzYXZlRGlyLFxuICAgICAgcGFnZXNGaWxlOiBwYXRoLmpvaW4oY29uZmlnRGlyLCBgJHtjaG9zZW4uaWR9LnBhZ2VzLmpzb25gKSxcbiAgICAgIGNvbmZpZ0ZpbGU6IHBhdGguam9pbihjb25maWdEaXIsIGAke2Nob3Nlbi5pZH0uY29uZmlnLmpzb25gKSxcbiAgICB9KTtcbiAgICBhd2FpdCBzYXZlVG9wQ29uZmlnKHRvcCk7XG4gICAgbG9nZ2VyLmluZm8oXG4gICAgICBgQWRkZWQgY29sbGVjdGlvbiB0byAke3BhdGguam9pbihcImNvbmZpZ3NcIiwgXCJvdXRsaW5lLXN5bmMuanNvblwiKX1gLFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgbG9nZ2VyLndhcm4oXCJDb2xsZWN0aW9uIGFscmVhZHkgY29uZmlndXJlZC5cIik7XG4gIH1cbn1cblxuLyoqXG4gKiBTaW1wbGUgc3RkaW4gbGluZSByZWFkZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHF1ZXN0aW9uKHByb21wdFRleHQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKHByb21wdFRleHQpO1xuICAgIHByb2Nlc3Muc3RkaW4ucmVzdW1lKCk7XG4gICAgcHJvY2Vzcy5zdGRpbi5zZXRFbmNvZGluZyhcInV0ZjhcIik7XG4gICAgcHJvY2Vzcy5zdGRpbi5vbmNlKFwiZGF0YVwiLCAoZGF0YSkgPT4ge1xuICAgICAgcHJvY2Vzcy5zdGRpbi5wYXVzZSgpO1xuICAgICAgcmVzb2x2ZShkYXRhLnRvU3RyaW5nKCkpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBCb290c3RyYXA6IGZldGNoIGRvY3VtZW50cyBmcm9tIGNvbGxlY3Rpb24sIGNyZWF0ZSBwYWdlcy5qc29uIGFuZCB3cml0ZSBtYXJrZG93biBmaWxlcy5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGJvb3RzdHJhcENvbGxlY3Rpb24ob3B0czoge1xuICBjb2xsZWN0aW9uSWQ6IHN0cmluZztcbiAgZHJ5UnVuPzogYm9vbGVhbjtcbn0pIHtcbiAgY29uc3QgeyBjb2xsZWN0aW9uSWQsIGRyeVJ1biA9IGZhbHNlIH0gPSBvcHRzO1xuICBsb2dnZXIuaW5mbyhgQm9vdHN0cmFwcGluZyBjb2xsZWN0aW9uICR7Y29sbGVjdGlvbklkfSAoZHJ5UnVuPSR7ZHJ5UnVufSkuLi5gKTtcblxuICBjb25zdCBkb2NzID0gYXdhaXQgbGlzdERvY3VtZW50c0luQ29sbGVjdGlvbihjb2xsZWN0aW9uSWQpO1xuICBsb2dnZXIuaW5mbyhgRmV0Y2hlZCAke2RvY3MubGVuZ3RofSBkb2N1bWVudHMgZnJvbSBPdXRsaW5lLmApO1xuICBsb2dnZXIuZGVidWcoXG4gICAgYEZpcnN0IDMgZG9jdW1lbnRzOiAke0pTT04uc3RyaW5naWZ5KGRvY3Muc2xpY2UoMCwgMyksIG51bGwsIDIpfWAsXG4gICk7XG5cbiAgLy8gMSkgYnVpbGQgZmxhdCBtYXAgb2Ygbm9kZXNcbiAgY29uc3QgbWFwID0gbmV3IE1hcDxzdHJpbmcsIFBhZ2VFbnRyeSAmIHsgcmF3PzogYW55IH0+KCk7XG4gIGZvciAoY29uc3QgZCBvZiBkb2NzKSB7XG4gICAgbWFwLnNldChkLmlkLCB7XG4gICAgICB0aXRsZTogZC50aXRsZSxcbiAgICAgIGZpbGU6IFwiXCIsXG4gICAgICBpZDogZC5pZCxcbiAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgIHJhdzogZCxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIDIpIGF0dGFjaCBjaGlsZHJlblxuICBjb25zdCByb290czogKFBhZ2VFbnRyeSAmIHsgcmF3PzogYW55IH0pW10gPSBbXTtcbiAgZm9yIChjb25zdCBub2RlIG9mIG1hcC52YWx1ZXMoKSkge1xuICAgIGNvbnN0IHJhdyA9IG5vZGUucmF3IHx8IHt9O1xuICAgIGNvbnN0IHBhcmVudElkID0gcmF3LnBhcmVudERvY3VtZW50SWQgPz8gcmF3LnBhcmVudElkID8/IG51bGw7XG4gICAgaWYgKHBhcmVudElkICYmIG1hcC5oYXMocGFyZW50SWQpKSB7XG4gICAgICBtYXAuZ2V0KHBhcmVudElkKS5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByb290cy5wdXNoKG5vZGUpO1xuICAgIH1cbiAgfVxuICBsb2dnZXIuZGVidWcoYEJ1aWx0IGRvY3VtZW50IHRyZWUgd2l0aCAke3Jvb3RzLmxlbmd0aH0gcm9vdChzKWApO1xuXG4gIC8vIDMpIGFzc2lnbiBwYXRoc1xuICBjb25zdCB7IHNhdmVEaXIgfSA9IGF3YWl0IGdldENvbGxlY3Rpb25GaWxlc0Jhc2UoY29sbGVjdGlvbklkKTtcbiAgZnVuY3Rpb24gYXNzaWduUGF0aHMobm9kZTogYW55LCBwYXJlbnREaXI6IHN0cmluZykge1xuICAgIGNvbnN0IHNsdWcgPSBzbHVnaWZ5VGl0bGUobm9kZS50aXRsZSB8fCBcInVudGl0bGVkXCIpO1xuICAgIGNvbnN0IGRpciA9IHBhdGguam9pbihwYXJlbnREaXIsIHNsdWcpO1xuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKGRpciwgXCJSRUFETUUubWRcIik7XG4gICAgbm9kZS5maWxlID0gZmlsZVBhdGg7XG4gICAgaWYgKG5vZGUuY2hpbGRyZW4/Lmxlbmd0aCkge1xuICAgICAgZm9yIChjb25zdCBjIG9mIG5vZGUuY2hpbGRyZW4pIHtcbiAgICAgICAgYXNzaWduUGF0aHMoYywgZGlyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgZm9yIChjb25zdCByIG9mIHJvb3RzKSB7XG4gICAgYXNzaWduUGF0aHMociwgc2F2ZURpcik7XG4gIH1cblxuICAvLyA0KSB3cml0ZSBmaWxlc1xuICBmb3IgKGNvbnN0IG4gb2YgbWFwLnZhbHVlcygpKSB7XG4gICAgY29uc3QgZmlsZVBhdGggPSBuLmZpbGU7XG4gICAgY29uc3QgY29udGVudCA9IG4ucmF3Py50ZXh0ID8/IGAjICR7bi50aXRsZX1cXG5cXG5gO1xuICAgIGlmICghZHJ5UnVuKSB7XG4gICAgICBhd2FpdCBmcy5ta2RpcihwYXRoLmRpcm5hbWUoZmlsZVBhdGgpLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShmaWxlUGF0aCwgY29udGVudCwgXCJ1dGY4XCIpO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBXcm90ZSBmaWxlOiAke2ZpbGVQYXRofWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgIGBbZHJ5LXJ1bl0gd291bGQgd3JpdGUgJHtmaWxlUGF0aH0gKCR7Y29udGVudC5sZW5ndGh9IGJ5dGVzKWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8vIDUpIGJ1aWxkIG1hbmlmZXN0XG4gIGZ1bmN0aW9uIHN0cmlwKG46IGFueSk6IFBhZ2VFbnRyeSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRpdGxlOiBuLnRpdGxlLFxuICAgICAgZmlsZTogbi5maWxlLFxuICAgICAgaWQ6IG4uaWQsXG4gICAgICBjaGlsZHJlbjogKG4uY2hpbGRyZW4gfHwgW10pLm1hcChzdHJpcCksXG4gICAgfTtcbiAgfVxuICBjb25zdCBtYW5pZmVzdDogTWFuaWZlc3QgPSB7IGNvbGxlY3Rpb25JZCwgcGFnZXM6IHJvb3RzLm1hcChzdHJpcCkgfTtcblxuICAvLyBzYXZlIG1hbmlmZXN0L2NvbmZpZ1xuICBjb25zdCB7XG4gICAgcGFnZXNGaWxlLFxuICAgIGNvbmZpZ0ZpbGUsXG4gICAgc2F2ZURpcjogY29uZmlndXJlZFNhdmVEaXIsXG4gICAgY29uZmlnRGlyLFxuICB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbkZpbGVzQmFzZShjb2xsZWN0aW9uSWQpO1xuICBsb2dnZXIuZGVidWcoXG4gICAgYENvbGxlY3Rpb24gKCR7Y29sbGVjdGlvbklkfSkgZmlsZXM6IHBhZ2VzRmlsZT0ke3BhZ2VzRmlsZX0sIGNvbmZpZ0ZpbGU9JHtjb25maWdGaWxlfSwgc2F2ZURpcj0ke2NvbmZpZ3VyZWRTYXZlRGlyfSwgY29uZmlnRGlyPSR7Y29uZmlnRGlyfWAsXG4gICk7XG5cbiAgYXdhaXQgZW5zdXJlQ29uZmlnRGlyKGNvbmZpZ0Rpcik7XG4gIGlmICghZHJ5UnVuKSB7XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKFxuICAgICAgcGFnZXNGaWxlLFxuICAgICAgYCR7SlNPTi5zdHJpbmdpZnkobWFuaWZlc3QsIG51bGwsIDIpfVxcbmAsXG4gICAgICBcInV0ZjhcIixcbiAgICApO1xuICAgIGxvZ2dlci5pbmZvKGBTYXZlZCBtYW5pZmVzdDogJHtwYWdlc0ZpbGV9YCk7XG5cbiAgICBpZiAoIWV4aXN0c1N5bmMoY29uZmlnRmlsZSkpIHtcbiAgICAgIGF3YWl0IGZzLndyaXRlRmlsZShcbiAgICAgICAgY29uZmlnRmlsZSxcbiAgICAgICAgYCR7SlNPTi5zdHJpbmdpZnkoeyBjb2xsZWN0aW9uSWQsIHNhdmVEaXI6IGNvbmZpZ3VyZWRTYXZlRGlyLCBtYXBwaW5nczogW10gfSwgbnVsbCwgMil9XFxuYCxcbiAgICAgICAgXCJ1dGY4XCIsXG4gICAgICApO1xuICAgICAgbG9nZ2VyLmluZm8oYENyZWF0ZWQgbmV3IGNvbmZpZzogJHtjb25maWdGaWxlfWApO1xuICAgIH1cbiAgICBsb2dnZXIuaW5mbyhgU2F2ZWQgY29uZmlnOiAke2NvbmZpZ0ZpbGV9YCk7XG5cbiAgICBjb25zdCB0b3AgPSAoYXdhaXQgbG9hZFRvcENvbmZpZygpKSB8fCB7IGNvbGxlY3Rpb25zOiBbXSB9O1xuICAgIGNvbnN0IGV4aXN0c1RvcCA9IHRvcC5jb2xsZWN0aW9ucy5maW5kKChjKSA9PiBjLmlkID09PSBjb2xsZWN0aW9uSWQpO1xuICAgIGlmICghZXhpc3RzVG9wKSB7XG4gICAgICB0b3AuY29sbGVjdGlvbnMudW5zaGlmdCh7XG4gICAgICAgIGlkOiBjb2xsZWN0aW9uSWQsXG4gICAgICAgIHNhdmVEaXI6IGNvbmZpZ3VyZWRTYXZlRGlyLFxuICAgICAgICBwYWdlc0ZpbGUsXG4gICAgICAgIGNvbmZpZ0ZpbGUsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IHNhdmVUb3BDb25maWcodG9wKTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgVXBkYXRlZCB0b3AgY29uZmlnIHdpdGggY29sbGVjdGlvbiAke2NvbGxlY3Rpb25JZH1gKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgYFtkcnktcnVuXSB3b3VsZCBzYXZlIHBhZ2VzIHRvICR7cGFnZXNGaWxlfSBhbmQgY29uZmlnIHRvICR7Y29uZmlnRmlsZX1gLFxuICAgICk7XG4gIH1cblxuICBsb2dnZXIuaW5mbyhcIkJvb3RzdHJhcCBjb21wbGV0ZVwiKTtcbn1cbiIsCiAgICAiaW1wb3J0IGZzIGZyb20gXCJub2RlOmZzL3Byb21pc2VzXCI7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSBcIm5vZGU6ZnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJub2RlOnBhdGhcIjtcbmltcG9ydCB7XG4gIGxvYWRUb3BDb25maWcsXG4gIGdldENvbGxlY3Rpb25GaWxlc0Jhc2UsXG4gIGxvYWRDb2xsZWN0aW9uQ29uZmlnLFxufSBmcm9tIFwiLi9jb25maWdcIjtcbmltcG9ydCB7XG4gIG5vcm1hbGl6ZUNvbnRlbnRJZ25vcmVXaGl0ZXNwYWNlLFxuICBnZXRMb2NhbFRpbWVzdGFtcE1zLFxuICBzYWZlV3JpdGVGaWxlLFxuICBzbHVnaWZ5VGl0bGUsXG59IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQge1xuICBmZXRjaERvY3VtZW50SW5mbyxcbiAgdXBkYXRlRG9jdW1lbnQsXG4gIGNyZWF0ZURvY3VtZW50LFxufSBmcm9tIFwiLi9vdXRsaW5lQXBpXCI7XG5pbXBvcnQgdHlwZSB7IE1hbmlmZXN0LCBQYWdlRW50cnkgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIi4uL2Jpbi9jbGlcIjtcblxuLyoqXG4gKiBMb2FkIHBhZ2VzLmpzb24gZm9yIGEgY29sbGVjdGlvbiAoaWYgbWlzc2luZywgZXJyb3IvYXNrIHRvIGluaXQpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkUGFnZXNNYW5pZmVzdChcbiAgY29sbGVjdGlvbklkOiBzdHJpbmcsXG4pOiBQcm9taXNlPE1hbmlmZXN0PiB7XG4gIGNvbnN0IHsgcGFnZXNGaWxlIH0gPSBhd2FpdCBnZXRDb2xsZWN0aW9uRmlsZXNCYXNlKGNvbGxlY3Rpb25JZCk7XG4gIGlmICghZXhpc3RzU3luYyhwYWdlc0ZpbGUpKSB7XG4gICAgbG9nZ2VyLmVycm9yKGAke3BhZ2VzRmlsZX0gbm90IGZvdW5kLiBSdW4gaW5pdC9zZXR1cCB0byBjcmVhdGUgaXRgKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7cGFnZXNGaWxlfSBub3QgZm91bmQuIFJ1biBpbml0L3NldHVwIHRvIGNyZWF0ZSBpdGApO1xuICB9XG4gIGNvbnN0IHJhdyA9IGF3YWl0IGZzLnJlYWRGaWxlKHBhZ2VzRmlsZSwgXCJ1dGY4XCIpO1xuICBsb2dnZXIuZGVidWcoYExvYWRlZCBwYWdlcyBtYW5pZmVzdCBmcm9tICR7cGFnZXNGaWxlfSAoJHtyYXcubGVuZ3RofSBieXRlcylgKTtcbiAgcmV0dXJuIEpTT04ucGFyc2UocmF3KSBhcyBNYW5pZmVzdDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHBlcnNpc3RQYWdlc01hbmlmZXN0KFxuICBjb2xsZWN0aW9uSWQ6IHN0cmluZyxcbiAgbWFuaWZlc3Q6IE1hbmlmZXN0LFxuICBkcnlSdW4gPSBmYWxzZSxcbikge1xuICBjb25zdCB7IHBhZ2VzRmlsZSB9ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbkZpbGVzQmFzZShjb2xsZWN0aW9uSWQpO1xuICBpZiAoZHJ5UnVuKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBbZHJ5LXJ1bl0gd291bGQgcGVyc2lzdCBtYW5pZmVzdCB0byAke3BhZ2VzRmlsZX1gKTtcbiAgICByZXR1cm47XG4gIH1cbiAgYXdhaXQgZnMud3JpdGVGaWxlKFxuICAgIHBhZ2VzRmlsZSxcbiAgICBgJHtKU09OLnN0cmluZ2lmeShtYW5pZmVzdCwgbnVsbCwgMil9XFxuYCxcbiAgICBcInV0ZjhcIixcbiAgKTtcbiAgbG9nZ2VyLmluZm8oYFBlcnNpc3RlZCBtYW5pZmVzdCB0byAke3BhZ2VzRmlsZX1gKTtcbn1cblxuLyoqXG4gKiBSZXNvbHZlIGRlc3RpbmF0aW9uIGZpbGUgcGF0aCBmb3IgYSBkb2N1bWVudCB1c2luZyBjb2xsZWN0aW9uIGNvbmZpZyBtYXBwaW5ncy5cbiAqXG4gKiBSdWxlczpcbiAqIC0gbWFwcGluZyB3aXRoIGlkIGV4YWN0IG1hdGNoIHdpbnNcbiAqIC0gbWFwcGluZyB3aXRoIHRpdGxlIGV4YWN0IG1hdGNoIG5leHRcbiAqIC0gbWFwcGluZy5wYXRoIG1heSBiZTpcbiAqICAgIC0gYSBmaWxlIHBhdGggKGVuZGluZyB3aXRoIGAubWRgKSAtPiBzZXQgbm9kZS5maWxlIHRvIHRoYXQgcGF0aFxuICogICAgLSBhIGRpcmVjdG9yeSBwYXRoIChlbmRzIHdpdGggYC9gIG9yIG5vIGV4dGVuc2lvbikgLT4gcGxhY2Ugbm9kZSBpbiB0aGF0IGRpciBhcyBSRUFETUUubWRcbiAqIC0gaWYgbm8gbWFwcGluZywgZmFsbCBiYWNrIHRvIGluaGVyaXRlZCBmb2xkZXIgYXBwcm9hY2g6XG4gKiAgICBwYXJlbnREaXIgKyBzbHVnL1JFQURNRS5tZFxuICovXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlNYXBwaW5nc1RvTWFuaWZlc3QoXG4gIG1hbmlmZXN0OiBNYW5pZmVzdCxcbiAgY29sbGVjdGlvbkNvbmZpZzogYW55LFxuKSB7XG4gIGNvbnN0IHJ1bGVzID0gKGNvbGxlY3Rpb25Db25maWc/Lm1hcHBpbmdzIHx8IFtdKSBhcyB7XG4gICAgbWF0Y2g6IGFueTtcbiAgICBwYXRoOiBzdHJpbmc7XG4gIH1bXTtcblxuICBmdW5jdGlvbiBpc0RpclBhdGgocDogc3RyaW5nKSB7XG4gICAgLy8gdHJlYXQgdHJhaWxpbmcgc2xhc2ggYXMgZGlyZWN0b3J5IE9SIGxhY2sgb2YgLm1kIGV4dGVuc2lvbiBhcyBkaXJlY3RvcnlcbiAgICBpZiAoIXApIHJldHVybiBmYWxzZTtcbiAgICBpZiAocC5lbmRzV2l0aChcIi9cIikgfHwgcC5lbmRzV2l0aChwYXRoLnNlcCkpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBwYXRoLmV4dG5hbWUocCkudG9Mb3dlckNhc2UoKSAhPT0gXCIubWRcIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFwcGx5VG9Ob2RlKG5vZGU6IGFueSwgcGFyZW50RGlyOiBzdHJpbmcgfCBudWxsKSB7XG4gICAgLy8gdHJ5IGlkIG1hdGNoIHRoZW4gdGl0bGUgbWF0Y2hcbiAgICBsZXQgbWF0Y2hlZCA9IGZhbHNlO1xuICAgIGZvciAoY29uc3QgciBvZiBydWxlcykge1xuICAgICAgaWYgKHIubWF0Y2g/LmlkICYmIG5vZGUuaWQgPT09IHIubWF0Y2guaWQpIHtcbiAgICAgICAgY29uc3QgcCA9IHIucGF0aDtcbiAgICAgICAgaWYgKGlzRGlyUGF0aChwKSkge1xuICAgICAgICAgIGNvbnN0IGRpciA9IHAuZW5kc1dpdGgoXCIvXCIpID8gcCA6IHA7XG4gICAgICAgICAgbm9kZS5maWxlID0gcGF0aC5qb2luKGRpciwgXCJSRUFETUUubWRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm9kZS5maWxlID0gcDtcbiAgICAgICAgfVxuICAgICAgICBtYXRjaGVkID0gdHJ1ZTtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgIGBNYXBwaW5nIGFwcGxpZWQgYnkgaWQgZm9yIFwiJHtub2RlLnRpdGxlfVwiIC0+ICR7bm9kZS5maWxlfWAsXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW1hdGNoZWQpIHtcbiAgICAgIGZvciAoY29uc3QgciBvZiBydWxlcykge1xuICAgICAgICBpZiAoci5tYXRjaD8udGl0bGUgJiYgbm9kZS50aXRsZSA9PT0gci5tYXRjaC50aXRsZSkge1xuICAgICAgICAgIGNvbnN0IHAgPSByLnBhdGg7XG4gICAgICAgICAgaWYgKGlzRGlyUGF0aChwKSkge1xuICAgICAgICAgICAgY29uc3QgZGlyID0gcC5lbmRzV2l0aChcIi9cIikgPyBwIDogcDtcbiAgICAgICAgICAgIG5vZGUuZmlsZSA9IHBhdGguam9pbihkaXIsIFwiUkVBRE1FLm1kXCIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub2RlLmZpbGUgPSBwO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtYXRjaGVkID0gdHJ1ZTtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgICBgTWFwcGluZyBhcHBsaWVkIGJ5IHRpdGxlIGZvciBcIiR7bm9kZS50aXRsZX1cIiAtPiAke25vZGUuZmlsZX1gLFxuICAgICAgICAgICk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBpZiBzdGlsbCBub3QgYXNzaWduZWQsIGluaGVyaXQgZnJvbSBwYXJlbnREaXIgYnkgdXNpbmcgc2x1ZyAtPiBSRUFETUUubWRcbiAgICBpZiAoIW5vZGUuZmlsZSkge1xuICAgICAgY29uc3Qgc2x1ZyA9IHNsdWdpZnlUaXRsZShub2RlLnRpdGxlIHx8IFwidW50aXRsZWRcIik7XG4gICAgICBjb25zdCBkaXIgPSBwYXJlbnREaXJcbiAgICAgICAgPyBwYXRoLmpvaW4ocGFyZW50RGlyLCBzbHVnKVxuICAgICAgICA6IHBhdGguam9pbihjb2xsZWN0aW9uQ29uZmlnPy5zYXZlRGlyIHx8IFwiZG9jc1wiLCBzbHVnKTtcbiAgICAgIG5vZGUuZmlsZSA9IHBhdGguam9pbihkaXIsIFwiUkVBRE1FLm1kXCIpO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBJbmhlcml0ZWQgcGF0aCBmb3IgXCIke25vZGUudGl0bGV9XCIgLT4gJHtub2RlLmZpbGV9YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIElmIG5vZGUuZmlsZSBpcyBhIGJhcmUgZmlsZW5hbWUgKG5vIGRpcmVjdG9yeSkgPT4gcHV0IHVuZGVyIHBhcmVudERpciBvciBzYXZlRGlyXG4gICAgICBjb25zdCBoYXNEaXIgPSBwYXRoLmRpcm5hbWUobm9kZS5maWxlKSAmJiBwYXRoLmRpcm5hbWUobm9kZS5maWxlKSAhPT0gXCIuXCI7XG4gICAgICBpZiAoIWhhc0Rpcikge1xuICAgICAgICBjb25zdCBiYXNlRGlyID0gcGFyZW50RGlyIHx8IGNvbGxlY3Rpb25Db25maWc/LnNhdmVEaXIgfHwgXCJkb2NzXCI7XG4gICAgICAgIG5vZGUuZmlsZSA9IHBhdGguam9pbihiYXNlRGlyLCBub2RlLmZpbGUpO1xuICAgICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgICAgYE5vcm1hbGl6ZWQgYmFyZSBmaWxlbmFtZSBmb3IgXCIke25vZGUudGl0bGV9XCIgLT4gJHtub2RlLmZpbGV9YCxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG1hcHBpbmcgbWF5IGJlIHJlbGF0aXZlOyBrZWVwIGFzLWlzXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgVXNpbmcgbWFwcGVkIHBhdGggZm9yIFwiJHtub2RlLnRpdGxlfVwiIC0+ICR7bm9kZS5maWxlfWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNvbXB1dGUgdGhpcyBub2RlJ3MgZGlyIHRvIHBhc3MgdG8gY2hpbGRyZW4gKGRpcmVjdG9yeSBjb250YWluaW5nIFJFQURNRS5tZClcbiAgICBjb25zdCBub2RlRGlyID0gcGF0aC5kaXJuYW1lKG5vZGUuZmlsZSk7XG5cbiAgICBpZiAobm9kZS5jaGlsZHJlbj8ubGVuZ3RoKSB7XG4gICAgICBmb3IgKGNvbnN0IGMgb2Ygbm9kZS5jaGlsZHJlbikge1xuICAgICAgICBhcHBseVRvTm9kZShjLCBub2RlRGlyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmb3IgKGNvbnN0IHAgb2YgbWFuaWZlc3QucGFnZXMpIHtcbiAgICBhcHBseVRvTm9kZShwIGFzIGFueSwgbnVsbCk7XG4gIH1cbiAgbG9nZ2VyLmRlYnVnKGBBcHBsaWVkIG1hcHBpbmdzIHRvIG1hbmlmZXN0IChydWxlcz0ke3J1bGVzLmxlbmd0aH0pYCk7XG4gIHJldHVybiBtYW5pZmVzdDtcbn1cblxuLyoqXG4gKiBDb21wYXJlIGNvbnRlbnQgaWdub3Jpbmcgd2hpdGVzcGFjZS9uZXdsaW5lc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY29udGVudHNFcXVhbElnbm9yaW5nV2hpdGVzcGFjZShhOiBzdHJpbmcsIGI6IHN0cmluZykge1xuICByZXR1cm4gKFxuICAgIG5vcm1hbGl6ZUNvbnRlbnRJZ25vcmVXaGl0ZXNwYWNlKGEpID09PSBub3JtYWxpemVDb250ZW50SWdub3JlV2hpdGVzcGFjZShiKVxuICApO1xufVxuXG4vKipcbiAqIERlY2lkZSB3aGV0aGVyIHRvIHB1bGwgb3IgcHVzaCBvciBza2lwIGZvciBvbmUgcGFnZS5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN5bmNQYWdlKFxuICBjb2xsZWN0aW9uSWQ6IHN0cmluZyxcbiAgbWFuaWZlc3Q6IE1hbmlmZXN0LFxuICBwYWdlOiBQYWdlRW50cnksXG4gIHBhcmVudElkOiBzdHJpbmcgfCBudWxsLFxuICBvcHRzOiB7IG1vZGU6IFwicHVsbFwiIHwgXCJwdXNoXCIgfCBcInN5bmNcIjsgZHJ5UnVuPzogYm9vbGVhbiB9LFxuKSB7XG4gIGNvbnN0IGZpbGVQYXRoID0gcGFnZS5maWxlO1xuICBjb25zdCBhYnNQYXRoID0gcGF0aC5yZXNvbHZlKGZpbGVQYXRoKTtcbiAgY29uc3QgZmlsZUV4aXN0cyA9IGV4aXN0c1N5bmMoYWJzUGF0aCk7XG5cbiAgbGV0IGxvY2FsVHMgPSAwO1xuICBpZiAoZmlsZUV4aXN0cykge1xuICAgIHRyeSB7XG4gICAgICBsb2NhbFRzID0gYXdhaXQgZ2V0TG9jYWxUaW1lc3RhbXBNcyhhYnNQYXRoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBGYWlsZWQgdG8gZ2V0IGxvY2FsIHRpbWVzdGFtcCBmb3IgJHthYnNQYXRofTogJHtlcnJ9YCk7XG4gICAgICBsb2NhbFRzID0gMDtcbiAgICB9XG4gIH1cblxuICBsZXQgcmVtb3RlRG9jOiBhbnkgPSBudWxsO1xuICBpZiAocGFnZS5pZCkge1xuICAgIHRyeSB7XG4gICAgICByZW1vdGVEb2MgPSBhd2FpdCBmZXRjaERvY3VtZW50SW5mbyhwYWdlLmlkKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci53YXJuKFxuICAgICAgICBgRmFpbGVkIHRvIGZldGNoIHJlbW90ZSBpbmZvIGZvciAke3BhZ2UudGl0bGV9ICgke3BhZ2UuaWR9KTogJHtlcnJ9YCxcbiAgICAgICk7XG4gICAgICByZW1vdGVEb2MgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHJlbW90ZVRleHQgPSByZW1vdGVEb2M/LnRleHQgPz8gbnVsbDtcbiAgY29uc3QgcmVtb3RlVXBkYXRlZEF0ID0gcmVtb3RlRG9jPy51cGRhdGVkQXRcbiAgICA/IG5ldyBEYXRlKHJlbW90ZURvYy51cGRhdGVkQXQpLmdldFRpbWUoKVxuICAgIDogMDtcblxuICBsb2dnZXIuZGVidWcoXG4gICAgYHN5bmNQYWdlKFwiJHtwYWdlLnRpdGxlfVwiKSBsb2NhbEV4aXN0cz0ke2ZpbGVFeGlzdHN9IGxvY2FsVHM9JHtsb2NhbFRzfSByZW1vdGVFeGlzdHM9JHshIXJlbW90ZURvY30gcmVtb3RlVXBkYXRlZEF0PSR7cmVtb3RlVXBkYXRlZEF0fWAsXG4gICk7XG5cbiAgLy8gZW5zdXJlIGxvY2FsIGZpbGUgZXhpc3RzIHdoZW4gbmVlZGVkIC0gY3JlYXRlIHBhcmVudCBkaXJzXG4gIGlmICghZmlsZUV4aXN0cykge1xuICAgIGlmIChvcHRzLm1vZGUgPT09IFwicHVsbFwiIHx8IG9wdHMubW9kZSA9PT0gXCJzeW5jXCIgfHwgb3B0cy5tb2RlID09PSBcInB1c2hcIikge1xuICAgICAgY29uc3QgZGF0YVRvV3JpdGUgPVxuICAgICAgICByZW1vdGVUZXh0ICE9IG51bGwgPyByZW1vdGVUZXh0IDogYCMgJHtwYWdlLnRpdGxlfVxcblxcbmA7XG4gICAgICBhd2FpdCBzYWZlV3JpdGVGaWxlKGFic1BhdGgsIGRhdGFUb1dyaXRlLCBvcHRzLmRyeVJ1biB8fCBmYWxzZSk7XG4gICAgICBsb2dnZXIuaW5mbyhcbiAgICAgICAgYFtJTklUXSBFbnN1cmVkIGxvY2FsIGZpbGUgZm9yIFwiJHtwYWdlLnRpdGxlfVwiIC0+ICR7YWJzUGF0aH1gLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvLyBjcmVhdGUgcmVtb3RlIGlmIG1pc3NpbmdcbiAgaWYgKCFwYWdlLmlkKSB7XG4gICAgY29uc3QgbG9jYWxDb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUoYWJzUGF0aCwgXCJ1dGY4XCIpO1xuICAgIGlmIChvcHRzLmRyeVJ1bikge1xuICAgICAgbG9nZ2VyLmluZm8oXG4gICAgICAgIGBbZHJ5LXJ1bl1bQ1JFQVRFXSBXb3VsZCBjcmVhdGUgcmVtb3RlIGRvYyBmb3IgXCIke3BhZ2UudGl0bGV9XCIgaW4gY29sbGVjdGlvbiAke2NvbGxlY3Rpb25JZH1gLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY3JlYXRlZCA9IGF3YWl0IGNyZWF0ZURvY3VtZW50KFxuICAgICAgICAgIHBhZ2UudGl0bGUsXG4gICAgICAgICAgbG9jYWxDb250ZW50LFxuICAgICAgICAgIGNvbGxlY3Rpb25JZCxcbiAgICAgICAgICBwYXJlbnRJZCxcbiAgICAgICAgKTtcbiAgICAgICAgcGFnZS5pZCA9IGNyZWF0ZWQ/LmlkID8/IHBhZ2UuaWQ7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBbQ1JFQVRFXSBDcmVhdGVkIHJlbW90ZSBcIiR7cGFnZS50aXRsZX1cIiBpZD0ke3BhZ2UuaWR9YCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgIGBbQ1JFQVRFXSBGYWlsZWQgdG8gY3JlYXRlIHJlbW90ZSBmb3IgJHtwYWdlLnRpdGxlfTogJHtlcnJ9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgbG9jYWxDb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUoYWJzUGF0aCwgXCJ1dGY4XCIpO1xuICAgIGlmIChvcHRzLm1vZGUgPT09IFwicHVsbFwiKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHJlbW90ZVRleHQgIT0gbnVsbCAmJlxuICAgICAgICAhY29udGVudHNFcXVhbElnbm9yaW5nV2hpdGVzcGFjZShsb2NhbENvbnRlbnQsIHJlbW90ZVRleHQpXG4gICAgICApIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oYFtQVUxMXSBSZW1vdGUgYXBwbGllZCB0byBsb2NhbCBmb3IgXCIke3BhZ2UudGl0bGV9XCJgKTtcbiAgICAgICAgYXdhaXQgc2FmZVdyaXRlRmlsZShhYnNQYXRoLCByZW1vdGVUZXh0ID8/IFwiXCIsIG9wdHMuZHJ5UnVuIHx8IGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgW1NLSVBdIE5vIGNoYW5nZSAocHVsbCkgZm9yIFwiJHtwYWdlLnRpdGxlfVwiYCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChvcHRzLm1vZGUgPT09IFwicHVzaFwiKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHJlbW90ZVRleHQgPT0gbnVsbCB8fFxuICAgICAgICAhY29udGVudHNFcXVhbElnbm9yaW5nV2hpdGVzcGFjZShsb2NhbENvbnRlbnQsIHJlbW90ZVRleHQpXG4gICAgICApIHtcbiAgICAgICAgaWYgKG9wdHMuZHJ5UnVuKSB7XG4gICAgICAgICAgbG9nZ2VyLmluZm8oXG4gICAgICAgICAgICBgW2RyeS1ydW5dW1BVU0hdIFdvdWxkIHVwZGF0ZSByZW1vdGUgXCIke3BhZ2UudGl0bGV9XCIgaWQ9JHtwYWdlLmlkfWAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jdW1lbnQocGFnZS5pZCwgcGFnZS50aXRsZSwgbG9jYWxDb250ZW50KTtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGBbUFVTSF0gVXBkYXRlZCByZW1vdGUgXCIke3BhZ2UudGl0bGV9XCIgaWQ9JHtwYWdlLmlkfWApO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgICBgW1BVU0hdIEZhaWxlZCB0byB1cGRhdGUgcmVtb3RlIGZvciAke3BhZ2UudGl0bGV9OiAke2Vycn1gLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgW1NLSVBdIE5vIGNoYW5nZSAocHVzaCkgZm9yIFwiJHtwYWdlLnRpdGxlfVwiYCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHN5bmM6IHRpbWVzdGFtcC1iYXNlZCBidXQgc2tpcCBpZiBvbmx5IHdoaXRlc3BhY2UgZGlmZmVyc1xuICAgICAgaWYgKHJlbW90ZVVwZGF0ZWRBdCA+IGxvY2FsVHMgKyA1MDApIHtcbiAgICAgICAgaWYgKCFjb250ZW50c0VxdWFsSWdub3JpbmdXaGl0ZXNwYWNlKGxvY2FsQ29udGVudCwgcmVtb3RlVGV4dCA/PyBcIlwiKSkge1xuICAgICAgICAgIGxvZ2dlci5pbmZvKFxuICAgICAgICAgICAgYFtQVUxMXSBSZW1vdGUgbmV3ZXIgLT4gb3ZlcndyaXRlIGxvY2FsIGZvciBcIiR7cGFnZS50aXRsZX1cImAsXG4gICAgICAgICAgKTtcbiAgICAgICAgICBhd2FpdCBzYWZlV3JpdGVGaWxlKGFic1BhdGgsIHJlbW90ZVRleHQgPz8gXCJcIiwgb3B0cy5kcnlSdW4gfHwgZmFsc2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICAgIGBbU0tJUF0gZXF1YWwgYWZ0ZXIgbm9ybWFsaXppbmcgKHJlbW90ZSBuZXdlciB0aW1lc3RhbXAgYnV0IGNvbnRlbnQgc2FtZSkgXCIke3BhZ2UudGl0bGV9XCJgLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAobG9jYWxUcyA+IHJlbW90ZVVwZGF0ZWRBdCArIDUwMCkge1xuICAgICAgICBpZiAoIWNvbnRlbnRzRXF1YWxJZ25vcmluZ1doaXRlc3BhY2UobG9jYWxDb250ZW50LCByZW1vdGVUZXh0ID8/IFwiXCIpKSB7XG4gICAgICAgICAgbG9nZ2VyLmluZm8oXG4gICAgICAgICAgICBgW1BVU0hdIExvY2FsIG5ld2VyIC0+IHVwZGF0ZSByZW1vdGUgZm9yIFwiJHtwYWdlLnRpdGxlfVwiYCxcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChvcHRzLmRyeVJ1bikge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oYFtkcnktcnVuXSB3b3VsZCB1cGRhdGUgcmVtb3RlICR7cGFnZS50aXRsZX1gKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jdW1lbnQocGFnZS5pZCwgcGFnZS50aXRsZSwgbG9jYWxDb250ZW50KTtcbiAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oXG4gICAgICAgICAgICAgICAgYFtQVVNIXSBVcGRhdGVkIHJlbW90ZSBcIiR7cGFnZS50aXRsZX1cIiBpZD0ke3BhZ2UuaWR9YCxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICAgICAgYFtQVVNIXSBGYWlsZWQgdG8gdXBkYXRlIHJlbW90ZSBmb3IgJHtwYWdlLnRpdGxlfTogJHtlcnJ9YCxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKFxuICAgICAgICAgICAgYFtTS0lQXSBlcXVhbCBhZnRlciBub3JtYWxpemluZyAobG9jYWwgbmV3ZXIgdGltZXN0YW1wIGJ1dCBjb250ZW50IHNhbWUpIFwiJHtwYWdlLnRpdGxlfVwiYCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZGVidWcoYFtTS0lQXSBObyBjaGFuZ2VzIGZvciBcIiR7cGFnZS50aXRsZX1cImApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHJlY3Vyc2UgdGhyb3VnaCBjaGlsZHJlblxuICBjb25zdCBuZXh0UGFyZW50SWQgPSBwYWdlLmlkIHx8IHBhcmVudElkO1xuICBpZiAocGFnZS5jaGlsZHJlbj8ubGVuZ3RoKSB7XG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiBwYWdlLmNoaWxkcmVuKSB7XG4gICAgICBhd2FpdCBzeW5jUGFnZShjb2xsZWN0aW9uSWQsIG1hbmlmZXN0LCBjaGlsZCwgbmV4dFBhcmVudElkLCBvcHRzKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBSdW4gc3luYyBmb3IgYSBjb2xsZWN0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBydW5TeW5jKG9wdHM6IHtcbiAgY29sbGVjdGlvbklkOiBzdHJpbmc7XG4gIG1vZGU6IFwicHVsbFwiIHwgXCJwdXNoXCIgfCBcInN5bmNcIjtcbiAgZHJ5UnVuPzogYm9vbGVhbjtcbn0pIHtcbiAgY29uc3QgeyBjb2xsZWN0aW9uSWQsIG1vZGUsIGRyeVJ1biA9IGZhbHNlIH0gPSBvcHRzO1xuICBsb2dnZXIuaW5mbyhcbiAgICBgU3RhcnRpbmcgJHttb2RlfSBmb3IgY29sbGVjdGlvbiAke2NvbGxlY3Rpb25JZH0gKGRyeVJ1bj0ke2RyeVJ1bn0pYCxcbiAgKTtcblxuICBjb25zdCBwYWdlc01hbmlmZXN0ID0gYXdhaXQgbG9hZFBhZ2VzTWFuaWZlc3QoY29sbGVjdGlvbklkKTtcbiAgY29uc3QgY29sbENmZyA9IChhd2FpdCBsb2FkQ29sbGVjdGlvbkNvbmZpZyhjb2xsZWN0aW9uSWQpKSB8fCB7XG4gICAgc2F2ZURpcjogXCJkb2NzXCIsXG4gICAgbWFwcGluZ3M6IFtdLFxuICB9O1xuXG4gIC8vIGFwcGx5IG1hcHBpbmdzICh0aGlzIHdpbGwgc2V0IGZvbGRlci1iYXNlZCBgZmlsZWAgZmllbGRzKVxuICBhcHBseU1hcHBpbmdzVG9NYW5pZmVzdChwYWdlc01hbmlmZXN0LCBjb2xsQ2ZnKTtcblxuICAvLyBlbnN1cmUgbG9jYWwgZmlsZXMvZm9sZGVycyBleGlzdCBhbmQgbm9ybWFsaXplIGFueSByZWxhdGl2ZSBmaWxlbmFtZXNcbiAgYXN5bmMgZnVuY3Rpb24gbm9ybWFsaXplUGF0aHMobm9kZTogYW55LCBwYXJlbnREaXI6IHN0cmluZyB8IG51bGwpIHtcbiAgICAvLyBpZiBub2RlLmZpbGUgaXMgYWJzZW50LCBhcHBseSBpbmhlcml0YW5jZSAoYXBwbHlNYXBwaW5nc1RvTWFuaWZlc3Qgc2hvdWxkIGhhdmUgc2V0IGl0KVxuICAgIGlmICghbm9kZS5maWxlKSB7XG4gICAgICBjb25zdCBzbHVnID0gc2x1Z2lmeVRpdGxlKG5vZGUudGl0bGUgfHwgXCJ1bnRpdGxlZFwiKTtcbiAgICAgIGNvbnN0IGRpciA9IHBhcmVudERpclxuICAgICAgICA/IHBhdGguam9pbihwYXJlbnREaXIsIHNsdWcpXG4gICAgICAgIDogcGF0aC5qb2luKGNvbGxDZmcuc2F2ZURpciB8fCBcImRvY3NcIiwgc2x1Zyk7XG4gICAgICBub2RlLmZpbGUgPSBwYXRoLmpvaW4oZGlyLCBcIlJFQURNRS5tZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgbm9kZS5maWxlIGlzIGJhcmUgZmlsZW5hbWUgd2l0aG91dCBkaXIgLT4gcHV0IGludG8gcGFyZW50RGlyIG9yIHNhdmVEaXJcbiAgICAgIGNvbnN0IGRpcm5hbWVPZkZpbGUgPSBwYXRoLmRpcm5hbWUobm9kZS5maWxlKTtcbiAgICAgIGlmICghZGlybmFtZU9mRmlsZSB8fCBkaXJuYW1lT2ZGaWxlID09PSBcIi5cIikge1xuICAgICAgICBjb25zdCBiYXNlRGlyID0gcGFyZW50RGlyIHx8IGNvbGxDZmcuc2F2ZURpciB8fCBcImRvY3NcIjtcbiAgICAgICAgbm9kZS5maWxlID0gcGF0aC5qb2luKGJhc2VEaXIsIG5vZGUuZmlsZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gY3JlYXRlIGRpcmVjdG9yeSBpZiBuZWVkZWQgKG5vdCB3cml0aW5nIGZpbGUgY29udGVudHMgaGVyZSwganVzdCBlbnN1cmluZyBzdHJ1Y3R1cmUpXG4gICAgY29uc3QgZGlyVG9NYWtlID0gcGF0aC5kaXJuYW1lKG5vZGUuZmlsZSk7XG4gICAgaWYgKCFkcnlSdW4pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGZzLm1rZGlyKGRpclRvTWFrZSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgRW5zdXJlZCBkaXJlY3RvcnkgJHtkaXJUb01ha2V9YCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oYEZhaWxlZCB0byBlbnN1cmUgZGlyZWN0b3J5ICR7ZGlyVG9NYWtlfTogJHtlcnJ9YCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgW2RyeS1ydW5dIHdvdWxkIGVuc3VyZSBkaXJlY3RvcnkgJHtkaXJUb01ha2V9YCk7XG4gICAgfVxuXG4gICAgY29uc3Qgbm9kZURpciA9IHBhdGguZGlybmFtZShub2RlLmZpbGUpO1xuICAgIGlmIChub2RlLmNoaWxkcmVuPy5sZW5ndGgpIHtcbiAgICAgIGZvciAoY29uc3QgYyBvZiBub2RlLmNoaWxkcmVuKSB7XG4gICAgICAgIGF3YWl0IG5vcm1hbGl6ZVBhdGhzKGMsIG5vZGVEaXIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIG5vcm1hbGl6ZSBmb3IgZWFjaCByb290XG4gIGZvciAoY29uc3Qgcm9vdCBvZiBwYWdlc01hbmlmZXN0LnBhZ2VzKSB7XG4gICAgYXdhaXQgbm9ybWFsaXplUGF0aHMocm9vdCBhcyBhbnksIG51bGwpO1xuICB9XG4gIGxvZ2dlci5kZWJ1ZyhcIkNvbXBsZXRlZCBwYXRoIG5vcm1hbGl6YXRpb24gZm9yIG1hbmlmZXN0XCIpO1xuXG4gIC8vIHJ1biBzeW5jIHJlY3Vyc2lvblxuICBmb3IgKGNvbnN0IHAgb2YgcGFnZXNNYW5pZmVzdC5wYWdlcykge1xuICAgIGF3YWl0IHN5bmNQYWdlKGNvbGxlY3Rpb25JZCwgcGFnZXNNYW5pZmVzdCwgcCwgbnVsbCwgeyBtb2RlLCBkcnlSdW4gfSk7XG4gIH1cblxuICAvLyBwZXJzaXN0IG1hbmlmZXN0ICh3cml0ZSBhbnkgY3JlYXRlZCBpZHMgYmFjaylcbiAgYXdhaXQgcGVyc2lzdFBhZ2VzTWFuaWZlc3QoY29sbGVjdGlvbklkLCBwYWdlc01hbmlmZXN0LCBkcnlSdW4pO1xuICBsb2dnZXIuaW5mbyhcIkRvbmUuXCIpO1xufVxuIiwKICAgICIjIS91c3IvYmluL2VudiBidW5cblxuLyogYmluL2NsaS50c1xuICAgLSBQYXJzZSBDTEkgZmxhZ3MgZmlyc3QgKHNvIC0tYXBpLWtleSBpcyBhcHBsaWVkIGJlZm9yZSBtb2R1bGVzIGltcG9ydCBlbnYpXG4gICAtIFN1cHBvcnQgcmVwZWF0YWJsZSAtLWNvbGxlY3Rpb24gZmxhZ3NcbiAgIC0gVGhlbiBkeW5hbWljYWxseSBpbXBvcnQgdGhlIHJlc3Qgb2YgdGhlIGFwcFxuKi9cblxuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSBcIi4uL2xpYi9sb2dnZXJcIjtcblxuY29uc3QgcmF3QXJncyA9IHByb2Nlc3MuYXJndi5zbGljZSgyKTtcbmxldCBERUJVRyA9IGZhbHNlO1xuXG4vLyBwYXJzZSBmbGFncyAocmVwZWF0YWJsZSAtLWNvbGxlY3Rpb24pXG5jb25zdCBmbGFnczogUmVjb3JkPHN0cmluZywgc3RyaW5nIHwgYm9vbGVhbiB8IHN0cmluZ1tdPiA9IHt9O1xuY29uc3QgcG9zaXRpb25hbHM6IHN0cmluZ1tdID0gW107XG5mb3IgKGxldCBpID0gMDsgaSA8IHJhd0FyZ3MubGVuZ3RoOyBpKyspIHtcbiAgY29uc3QgYSA9IHJhd0FyZ3NbaV07XG4gIGlmIChhID09PSBcIi0taGVscFwiIHx8IGEgPT09IFwiLWhcIikge1xuICAgIHBvc2l0aW9uYWxzLnB1c2goXCItLWhlbHBcIik7XG4gIH0gZWxzZSBpZiAoYSA9PT0gXCItLXZlcmJvc2VcIikge1xuICAgIHBvc2l0aW9uYWxzLnB1c2goXCItLXZlcmJvc2VcIik7XG4gIH0gZWxzZSBpZiAoYS5zdGFydHNXaXRoKFwiLS1jb2xsZWN0aW9uPVwiKSB8fCBhLnN0YXJ0c1dpdGgoXCItLWNvbGxlY3Rpb246XCIpKSB7XG4gICAgY29uc3QgdmFsID0gYS5zcGxpdCgvWzo9XS8pWzFdIHx8IFwiXCI7XG4gICAgaWYgKCFmbGFncy5jb2xsZWN0aW9uKSBmbGFncy5jb2xsZWN0aW9uID0gW107XG4gICAgKGZsYWdzLmNvbGxlY3Rpb24gYXMgc3RyaW5nW10pLnB1c2godmFsKTtcbiAgfSBlbHNlIGlmIChhID09PSBcIi0tY29sbGVjdGlvblwiKSB7XG4gICAgLy8gc3VwcG9ydCBgLS1jb2xsZWN0aW9uIDx2YWx1ZT5gXG4gICAgY29uc3QgdmFsID0gcmF3QXJnc1tpICsgMV07XG4gICAgaWYgKHZhbCAmJiAhdmFsLnN0YXJ0c1dpdGgoXCItLVwiKSkge1xuICAgICAgaWYgKCFmbGFncy5jb2xsZWN0aW9uKSBmbGFncy5jb2xsZWN0aW9uID0gW107XG4gICAgICAoZmxhZ3MuY29sbGVjdGlvbiBhcyBzdHJpbmdbXSkucHVzaCh2YWwpO1xuICAgICAgaSsrOyAvLyBjb25zdW1lIG5leHQgYXJnXG4gICAgfVxuICB9IGVsc2UgaWYgKGEuc3RhcnRzV2l0aChcIi0tXCIpKSB7XG4gICAgY29uc3QgW2ssIHZdID0gYS5yZXBsYWNlKC9eLS0vLCBcIlwiKS5zcGxpdChcIj1cIik7XG4gICAgZmxhZ3Nba10gPSB2ID09PSB1bmRlZmluZWQgPyB0cnVlIDogdjtcbiAgfSBlbHNlIHtcbiAgICBwb3NpdGlvbmFscy5wdXNoKGEpO1xuICB9XG59XG5cbi8vIElmIHVzZXIgcGFzc2VkIC0tYXBpLWtleSBvciAtLWJhc2UtdXJsLCBzZXQgdGhlbSBpbW1lZGlhdGVseSBzbyBkeW5hbWljIGltcG9ydHMgc2VlIHRoZW0uXG5pZiAoZmxhZ3NbXCJhcGkta2V5XCJdKSB7XG4gIC8vIGRvIE5PVCBsb2cgdGhlIGtleSB0byBhdm9pZCBhY2NpZGVudGFsIGxlYWthZ2UgaW4gbG9nc1xuICBwcm9jZXNzLmVudi5PVVRMSU5FX0FQSV9LRVkgPSBTdHJpbmcoZmxhZ3NbXCJhcGkta2V5XCJdKTtcbn1cbmlmIChmbGFnc1tcImJhc2UtdXJsXCJdKSB7XG4gIHByb2Nlc3MuZW52Lk9VVExJTkVfQkFTRV9VUkwgPSBTdHJpbmcoZmxhZ3NbXCJiYXNlLXVybFwiXSk7XG59XG5cbmlmIChwb3NpdGlvbmFscy5pbmNsdWRlcyhcIi0tdmVyYm9zZVwiKSkge1xuICBERUJVRyA9IHRydWU7XG59XG5cbmV4cG9ydCBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKHtcbiAgbGV2ZWw6IERFQlVHID8gXCJERUJVR1wiIDogXCJJTkZPXCIsXG59KTtcblxuaWYgKHBvc2l0aW9uYWxzLmluY2x1ZGVzKFwiLS1oZWxwXCIpIHx8IGZsYWdzLmhlbHAgfHwgZmxhZ3MuaCkge1xuICBjb25zb2xlLmxvZyhgXG5Vc2FnZTpcbiAgT1VUTElORV9BUElfS0VZPS4uLiBidW4gcnVuIGJpbi9jbGkudHMgW2NvbW1hbmRdIFstLWNvbGxlY3Rpb249SURdLi4uIFstLWRyeS1ydW5dIFstLWFwaS1rZXk9XCIuLi5cIl1cblxuQ29tbWFuZHM6XG4gIHNldHVwICAgICAgICAgICAgICAgICAgICAtIGludGVyYWN0aXZlIHNldHVwOiBsaXN0IGNvbGxlY3Rpb25zLCBjaG9vc2Ugb25lXG4gIGxpc3QtY29sbGVjdGlvbnMgICAgICAgICAtIHByaW50IGNvbGxlY3Rpb25zXG4gIGluaXQgLS1jb2xsZWN0aW9uPUlEICAgICAtIGJvb3RzdHJhcCBwYWdlcy5qc29uICsgbWFya2Rvd24gKHJlcGVhdGFibGUpXG4gIHB1bGwgLS1jb2xsZWN0aW9uPUlEICAgICAtIHB1bGwgcmVtb3RlIGNoYW5nZXMgKHJlcGVhdGFibGUpXG4gIHB1c2ggLS1jb2xsZWN0aW9uPUlEICAgICAtIHB1c2ggbG9jYWwgY2hhbmdlcyAocmVwZWF0YWJsZSlcbiAgc3luYyAtLWNvbGxlY3Rpb249SUQgICAgIC0gYmlkaXJlY3Rpb25hbCBzeW5jIChyZXBlYXRhYmxlKVxuXG5GbGFnczpcbiAgLS1jb2xsZWN0aW9uPUlEICAgICAgICAgIFJlcGVhdGFibGU7IHJ1biBjb21tYW5kIGFnYWluc3QgbXVsdGlwbGUgY29sbGVjdGlvbnNcbiAgLS1hcGkta2V5PVwiLi4uXCIgICAgICAgICAgUHJvdmlkZSBPdXRsaW5lIEFQSSBrZXkgKG92ZXJyaWRlcyBlbnYgdmFyKVxuICAtLWJhc2UtdXJsPVwiLi4uXCIgICAgICAgICBQcm92aWRlIE91dGxpbmUgYmFzZSBVUkwgKG92ZXJyaWRlcyBlbnYgdmFyKVxuICAtLWRyeS1ydW4gICAgICAgICAgICAgICAgUHJldmlldyBvbmx5XG4gIC0taGVscCwgLWhcbkV4YW1wbGVzOlxuICBPVVRMSU5FX0FQSV9LRVk9Li4uIGJ1bnggQGRvY2tzdGF0L291dGxpbmUtc3luYyAtLWNvbGxlY3Rpb249XCJpZDFcIiAtLWNvbGxlY3Rpb249XCJpZDJcIiBzeW5jIC0tZHJ5LXJ1blxuICBidW4gcnVuIGJpbi9jbGkudHMgc3luYyAtLWFwaS1rZXk9XCJza194eHhcIiAtLWNvbGxlY3Rpb249XCJpZDFcIlxuYCk7XG4gIHByb2Nlc3MuZXhpdCgwKTtcbn1cblxuY29uc3QgeyBsb2FkVG9wQ29uZmlnIH0gPSBhd2FpdCBpbXBvcnQoXCIuLi9saWIvY29uZmlnXCIpO1xuY29uc3QgeyBsaXN0Q29sbGVjdGlvbnNQcm9tcHQsIGJvb3RzdHJhcENvbGxlY3Rpb24gfSA9IGF3YWl0IGltcG9ydChcbiAgXCIuLi9saWIvaW5pdFwiXG4pO1xuY29uc3QgeyBydW5TeW5jIH0gPSBhd2FpdCBpbXBvcnQoXCIuLi9saWIvc3luY0VuZ2luZVwiKTtcblxubG9nZ2VyLmRlYnVnKFwiUGFyc2luZyBwb3NpdGlvbmFsc1wiKTtcbmNvbnN0IGNtZCA9IHBvc2l0aW9uYWxzWzBdIHx8IFwic3luY1wiO1xuY29uc3QgRFJZX1JVTiA9IEJvb2xlYW4oZmxhZ3NbXCJkcnktcnVuXCJdKTtcbmNvbnN0IGNvbGxlY3Rpb25zRnJvbUNsaSA9IChmbGFncy5jb2xsZWN0aW9uIGFzIHN0cmluZ1tdIHwgdW5kZWZpbmVkKSA/PyBbXTtcbmxvZ2dlci5kZWJ1ZyhcbiAgYFBhcnNlZCBjbWQ9JHtjbWR9IERSWV9SVU49JHtEUllfUlVOfSBjb2xsZWN0aW9uc0Zyb21DbGk9JHtjb2xsZWN0aW9uc0Zyb21DbGl9YCxcbik7XG5cbnRyeSB7XG4gIGxvZ2dlci5kZWJ1ZyhcIkxvYWRpbmcgdG9wIGNvbmZpZ1wiKTtcbiAgY29uc3QgdG9wQ29uZmlnID0gKGF3YWl0IGxvYWRUb3BDb25maWcoKSkgfHwgeyBjb2xsZWN0aW9uczogW10gfTtcbiAgbG9nZ2VyLmRlYnVnKGBMb2FkZWQ6ICR7SlNPTi5zdHJpbmdpZnkodG9wQ29uZmlnKX1gKTtcblxuICBjb25zdCByZXNvbHZlVGFyZ2V0cyA9ICgpOiBzdHJpbmdbXSA9PiB7XG4gICAgbG9nZ2VyLmRlYnVnKFwiUmVzb2x2aW5nIHRhcmdldHNcIik7XG4gICAgaWYgKGNvbGxlY3Rpb25zRnJvbUNsaS5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgIGBGb3VuZCBDb2xsZWN0aW9uIGZyb20gY2xpOiAke0pTT04uc3RyaW5naWZ5KGNvbGxlY3Rpb25zRnJvbUNsaSl9YCxcbiAgICAgICk7XG4gICAgICByZXR1cm4gY29sbGVjdGlvbnNGcm9tQ2xpO1xuICAgIH1cbiAgICBpZiAodG9wQ29uZmlnLmNvbGxlY3Rpb25zICYmIHRvcENvbmZpZy5jb2xsZWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXG4gICAgICAgIGBGb3VuZCBjb2xsZWN0aW9ucyBpbiBUb3AgQ29uZmlnOiAke0pTT04uc3RyaW5naWZ5KHRvcENvbmZpZyl9YCxcbiAgICAgICk7XG4gICAgICByZXR1cm4gdG9wQ29uZmlnLmNvbGxlY3Rpb25zLm1hcCgoYykgPT4gYy5pZCk7XG4gICAgfVxuICAgIGxvZ2dlci53YXJuKFwiQ291bGRuJ3QgcmVzb2x2ZSB0YXJnZXRzXCIpO1xuICAgIHJldHVybiBbXTtcbiAgfTtcblxuICBpZiAoY21kID09PSBcImxpc3QtY29sbGVjdGlvbnNcIikge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIkxpc3RpbmcgY29sbGVjdGlvbnNcIik7XG4gICAgYXdhaXQgbGlzdENvbGxlY3Rpb25zUHJvbXB0KHsgZHJ5UnVuOiBEUllfUlVOLCBub25JbnRlcmFjdGl2ZTogZmFsc2UgfSk7XG4gICAgcHJvY2Vzcy5leGl0KDApO1xuICB9XG5cbiAgaWYgKGNtZCA9PT0gXCJzZXR1cFwiKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFwiUnVubmluZyBzZXR1cFwiKTtcbiAgICBhd2FpdCBsaXN0Q29sbGVjdGlvbnNQcm9tcHQoeyBkcnlSdW46IERSWV9SVU4sIG5vbkludGVyYWN0aXZlOiBmYWxzZSB9KTtcbiAgICBwcm9jZXNzLmV4aXQoMCk7XG4gIH1cblxuICBpZiAoY21kID09PSBcImluaXRcIikge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIlJ1bm5pbmcgaW5pdFwiKTtcbiAgICBjb25zdCB0YXJnZXRzID0gcmVzb2x2ZVRhcmdldHMoKTtcbiAgICBpZiAoIXRhcmdldHMubGVuZ3RoKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkluaXQgcmVxdWlyZXMgYXQgbGVhc3Qgb25lIGNvbGxlY3Rpb24uIFByb3ZpZGUgLS1jb2xsZWN0aW9uIG9yIHJ1biBzZXR1cC5cIixcbiAgICAgICk7XG4gICAgZm9yIChjb25zdCBjb2xsZWN0aW9uSWQgb2YgdGFyZ2V0cykge1xuICAgICAgYXdhaXQgYm9vdHN0cmFwQ29sbGVjdGlvbih7IGNvbGxlY3Rpb25JZCwgZHJ5UnVuOiBEUllfUlVOIH0pO1xuICAgIH1cbiAgICBwcm9jZXNzLmV4aXQoMCk7XG4gIH1cblxuICBpZiAoY21kID09PSBcInB1bGxcIiB8fCBjbWQgPT09IFwicHVzaFwiIHx8IGNtZCA9PT0gXCJzeW5jXCIpIHtcbiAgICBsb2dnZXIuZGVidWcoXCJQYXJzaW5nIENNRCAocHVsbC9wdXNoL3N5bmMpXCIpO1xuICAgIGNvbnN0IHRhcmdldHMgPSByZXNvbHZlVGFyZ2V0cygpO1xuICAgIGlmICghdGFyZ2V0cy5sZW5ndGgpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDb21tYW5kIFwiJHtjbWR9XCIgcmVxdWlyZXMgYXQgbGVhc3Qgb25lIGNvbGxlY3Rpb24gaWQuIFByb3ZpZGUgd2l0aCAtLWNvbGxlY3Rpb249SUQgb3IgcnVuIHNldHVwLmAsXG4gICAgICApO1xuICAgIGNvbnN0IG1vZGUgPSBjbWQgPT09IFwicHVsbFwiID8gXCJwdWxsXCIgOiBjbWQgPT09IFwicHVzaFwiID8gXCJwdXNoXCIgOiBcInN5bmNcIjtcbiAgICBmb3IgKGNvbnN0IGNvbGxlY3Rpb25JZCBvZiB0YXJnZXRzKSB7XG4gICAgICBhd2FpdCBydW5TeW5jKHsgY29sbGVjdGlvbklkLCBtb2RlOiBtb2RlIGFzIGFueSwgZHJ5UnVuOiBEUllfUlVOIH0pO1xuICAgIH1cbiAgICBwcm9jZXNzLmV4aXQoMCk7XG4gIH1cblxuICBsb2dnZXIuZXJyb3IoYFVua25vd24gY29tbWFuZDogJHtjbWR9YCk7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn0gY2F0Y2ggKGVycjogYW55KSB7XG4gIGNvbnNvbGUuZXJyb3IoXCJFUlJPUjpcIiwgZXJyPy5tZXNzYWdlIHx8IGVycik7XG4gIHByb2Nlc3MuZXhpdCgxKTtcbn1cbiIKICBdLAogICJtYXBwaW5ncyI6ICI7O21LQXFCTyxNQUFNLENBQU8sQ0FDVixTQUNBLE9BQ0EsY0FDQSxLQUtSLFdBQVcsQ0FBQyxFQUtULENBQ0QsSUFDRSxRQUFRLE9BQ1IsU0FBUyxHQUNULFlBQVksR0FDWixRQUNFLEdBQVEsQ0FBQyxFQUViLEtBQUssU0FBVyxFQUNoQixLQUFLLGNBQWdCLEVBQ3JCLEtBQUssS0FBTyxFQUdaLElBQU0sRUFBYSxPQUFPLFVBQVksZUFBaUIsUUFBUSxJQUFJLFNBQzdELEVBQ0osT0FBTyxVQUFZLGVBQ2pCLFFBQVEsVUFDUixRQUFRLE9BQU8sTUFDbkIsS0FBSyxPQUFTLElBQVcsR0FBYyxFQUdqQyxTQUFTLENBQUMsRUFBaUIsQ0FDakMsT0FDRSxFQUFZLElBQVUsR0FDdEIsRUFBWSxJQUFVLEVBQVksS0FBSyxXQUN2QyxFQUFZLEtBQUssVUFBWSxFQUFZLEtBSXJDLFNBQVMsQ0FBQyxFQUFrQyxDQUNsRCxPQUFRLE9BQ0QsUUFDSCxNQUFPLENBQUUsSUFBSyxRQUFTLE1BQU8sRUFBSyxNQUFPLE1BQU8sY0FBSSxNQUNsRCxPQUNILE1B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RUFDdEUsUUFBUSxLQUFLLENBQUMsRUFHaEIsR0FBSSxJQUFRLFFBQ1YsRUFBTyxNQUFNLGVBQWUsRUFDNUIsTUFBTSxHQUFzQixDQUFFLE9BQVEsRUFBUyxlQUFnQixFQUFNLENBQUMsRUFDdEUsUUFBUSxLQUFLLENBQUMsRUFHaEIsR0FBSSxJQUFRLE9BQVEsQ0FDbEIsRUFBTyxNQUFNLGNBQWMsRUFDM0IsSUFBTSxFQUFVLEVBQWUsRUFDL0IsSUFBSyxFQUFRLE9BQ1gsTUFBTSxJQUFJLE1BQ1IsMkVBQ0YsRUFDRixRQUFXLEtBQWdCLEVBQ3pCLE1BQU0sR0FBb0IsQ0FBRSxlQUFjLE9BQVEsQ0FBUSxDQUFDLEVBRTdELFFBQVEsS0FBSyxDQUFDLEVBR2hCLEdBQUksSUFBUSxRQUFVLElBQVEsUUFBVSxJQUFRLE9BQVEsQ0FDdEQsRUFBTyxNQUFNLDhCQUE4QixFQUMzQyxJQUFNLEVBQVUsRUFBZSxFQUMvQixJQUFLLEVBQVEsT0FDWCxNQUFNLElBQUksTUFDUixZQUFZLG9GQUNkLEVBQ0YsSUFBTSxFQUFPLElBQVEsT0FBUyxPQUFTLElBQVEsT0FBUyxPQUFTLE9BQ2pFLFFBQVcsS0FBZ0IsRUFDekIsTUFBTSxHQUFRLENBQUUsZUFBYyxLQUFNLEVBQWEsT0FBUSxDQUFRLENBQUMsRUFFcEUsUUFBUSxLQUFLLENBQUMsRUFHaEIsRUFBTyxNQUFNLG9CQUFvQixHQUFLLEVBQ3RDLFFBQVEsS0FBSyxDQUFDLEVBQ2QsTUFBTyxFQUFVLENBQ2pCLFFBQVEsTUFBTSxTQUFVLEdBQUssU0FBVyxDQUFHLEVBQzNDLFFBQVEsS0FBSyxDQUFDIiwKICAiZGVidWdJZCI6ICJDOUYxMjk2QzJERTcyMzAzNjQ3NTZFMjE2NDc1NkUyMSIsCiAgIm5hbWVzIjogW10KfQ==
